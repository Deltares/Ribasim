<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Examples – Ribasim</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../getting-started/tutorial/reservoir.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0b1189524dc19e09ab363e9b4d3e2f65.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../assets/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="https://user-images.githubusercontent.com/4471859/224825908-bee7e044-bc6b-4561-8b08-5d330cce3ed5.png" alt="" class="navbar-logo light-content">
    <img src="https://user-images.githubusercontent.com/4471859/224825908-bee7e044-bc6b-4561-8b08-5d330cce3ed5.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Ribasim</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../getting-started/install.html" aria-current="page"> 
<span class="menu-text">Getting started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../guide/qgis.html"> 
<span class="menu-text">How-to guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../concept/concept.html"> 
<span class="menu-text">Concepts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reference/index.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../dev/index.html"> 
<span class="menu-text">Contributing</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Deltares/Ribasim"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../getting-started/examples.html">Examples</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started/install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started/tutorial/natural-flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Natural flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started/tutorial/irrigation-demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Irrigation demand</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started/tutorial/reservoir.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reservoir</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started/examples.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Examples</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#basic-model-with-static-forcing" id="toc-basic-model-with-static-forcing" class="nav-link active" data-scroll-target="#basic-model-with-static-forcing"><span class="header-section-number">1</span> Basic model with static forcing</a>
  <ul class="collapse">
  <li><a href="#running-a-model" id="toc-running-a-model" class="nav-link" data-scroll-target="#running-a-model"><span class="header-section-number">1.1</span> Running a model</a></li>
  </ul></li>
  <li><a href="#model-with-discrete-control" id="toc-model-with-discrete-control" class="nav-link" data-scroll-target="#model-with-discrete-control"><span class="header-section-number">2</span> Model with discrete control</a></li>
  <li><a href="#model-with-pid-control" id="toc-model-with-pid-control" class="nav-link" data-scroll-target="#model-with-pid-control"><span class="header-section-number">3</span> Model with PID control</a></li>
  <li><a href="#polderboezem-water-management-with-allocation" id="toc-polderboezem-water-management-with-allocation" class="nav-link" data-scroll-target="#polderboezem-water-management-with-allocation"><span class="header-section-number">4</span> Polder/Boezem water management with allocation</a></li>
  <li><a href="#model-with-continuous-control" id="toc-model-with-continuous-control" class="nav-link" data-scroll-target="#model-with-continuous-control"><span class="header-section-number">5</span> Model with continuous control</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Examples</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This is an overview of example codes to set-up and run models.</p>
<div id="7bab3c52" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ribasim <span class="im">import</span> run_ribasim</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="basic-model-with-static-forcing" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Basic model with static forcing</h1>
<div id="f3f2784b" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ribasim <span class="im">import</span> Allocation, Model, Node, Solver</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ribasim.config <span class="im">import</span> Experimental</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ribasim.nodes <span class="im">import</span> (</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    basin,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    continuous_control,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    discrete_control,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    flow_boundary,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    level_boundary,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    level_demand,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    linear_resistance,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    manning_resistance,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    outlet,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    pid_control,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    pump,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    tabulated_rating_curve,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    user_demand,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="f7fea1b2" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span> Path(<span class="st">"data"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>shutil.rmtree(datadir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="687a3134" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(starttime<span class="op">=</span><span class="st">"2020-01-01"</span>, endtime<span class="op">=</span><span class="st">"2021-01-01"</span>, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup the basins:</p>
<div id="287e9bd9" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> pd.date_range(model.starttime, model.endtime)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>day_of_year <span class="op">=</span> time.day_of_year.to_numpy()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>seconds_per_day <span class="op">=</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>evaporation <span class="op">=</span> (</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    (<span class="op">-</span><span class="fl">1.0</span> <span class="op">*</span> np.cos(day_of_year <span class="op">/</span> <span class="fl">365.0</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> np.pi) <span class="op">+</span> <span class="fl">1.0</span>) <span class="op">*</span> <span class="fl">0.0025</span> <span class="op">/</span> seconds_per_day</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(seed<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>precipitation <span class="op">=</span> (</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    rng.lognormal(mean<span class="op">=-</span><span class="fl">1.0</span>, sigma<span class="op">=</span><span class="fl">1.7</span>, size<span class="op">=</span>time.size) <span class="op">*</span> <span class="fl">0.001</span> <span class="op">/</span> seconds_per_day</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert steady forcing to m/s</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 mm/d precipitation, 1 mm/d evaporation</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>basin_data <span class="op">=</span> [</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    basin.Profile(area<span class="op">=</span>[<span class="fl">0.01</span>, <span class="fl">1000.0</span>], level<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>]),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    basin.Time(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        time<span class="op">=</span>pd.date_range(model.starttime, model.endtime),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        drainage<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        potential_evaporation<span class="op">=</span>evaporation,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        infiltration<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        precipitation<span class="op">=</span>precipitation,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    basin.State(level<span class="op">=</span>[<span class="fl">1.4</span>]),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>basin1 <span class="op">=</span> model.basin.add(Node(<span class="dv">1</span>, Point(<span class="fl">0.0</span>, <span class="fl">0.0</span>)), basin_data)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>basin3 <span class="op">=</span> model.basin.add(Node(<span class="dv">3</span>, Point(<span class="fl">2.0</span>, <span class="fl">0.0</span>)), basin_data)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>basin6 <span class="op">=</span> model.basin.add(Node(<span class="dv">6</span>, Point(<span class="fl">3.0</span>, <span class="fl">2.0</span>)), basin_data)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>basin9 <span class="op">=</span> model.basin.add(Node(<span class="dv">9</span>, Point(<span class="fl">5.0</span>, <span class="fl">0.0</span>)), basin_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup linear resistance:</p>
<div id="f17f057e" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>linear_resistance10 <span class="op">=</span> model.linear_resistance.add(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">10</span>, Point(<span class="fl">6.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    [linear_resistance.Static(resistance<span class="op">=</span>[<span class="fl">5e3</span>])],</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>linear_resistance12 <span class="op">=</span> model.linear_resistance.add(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">12</span>, Point(<span class="fl">2.0</span>, <span class="fl">1.0</span>)),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    [linear_resistance.Static(resistance<span class="op">=</span>[<span class="fl">3600.0</span> <span class="op">*</span> <span class="fl">24.0</span> <span class="op">/</span> <span class="fl">100.0</span>])],</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup Manning resistance:</p>
<div id="55a0f5c8" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>manning_resistance2 <span class="op">=</span> model.manning_resistance.add(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">2</span>, Point(<span class="fl">1.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        manning_resistance.Static(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            length<span class="op">=</span>[<span class="dv">900</span>], manning_n<span class="op">=</span>[<span class="fl">0.04</span>], profile_width<span class="op">=</span>[<span class="fl">6.0</span>], profile_slope<span class="op">=</span>[<span class="fl">3.0</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Set up rating curve nodes:</p>
<div id="c0da64f2" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="dv">10</span> <span class="op">/</span> <span class="dv">86400</span>  <span class="co"># 10 m³/day</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tabulated_rating_curve4 <span class="op">=</span> model.tabulated_rating_curve.add(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">8</span>, Point(<span class="fl">3.0</span>, <span class="op">-</span><span class="fl">1.0</span>)),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        tabulated_rating_curve.Static(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>],</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            flow_rate<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.6</span> <span class="op">*</span> q],</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>tabulated_rating_curve5 <span class="op">=</span> model.tabulated_rating_curve.add(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">5</span>, Point(<span class="fl">3.0</span>, <span class="fl">1.0</span>)),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        tabulated_rating_curve.Static(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>],</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            flow_rate<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.3</span> <span class="op">*</span> q],</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>tabulated_rating_curve8 <span class="op">=</span> model.tabulated_rating_curve.add(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">4</span>, Point(<span class="fl">4.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        tabulated_rating_curve.Static(</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>],</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            flow_rate<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.1</span> <span class="op">*</span> q],</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup pump:</p>
<div id="541e7bc0" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pump7 <span class="op">=</span> model.pump.add(Node(<span class="dv">7</span>, Point(<span class="fl">4.0</span>, <span class="fl">1.0</span>)), [pump.Static(flow_rate<span class="op">=</span>[<span class="fl">0.5</span> <span class="op">/</span> <span class="dv">3600</span>])])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup level boundary:</p>
<div id="eb3a36b4" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>level_boundary11 <span class="op">=</span> model.level_boundary.add(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">11</span>, Point(<span class="fl">2.0</span>, <span class="fl">2.0</span>)), [level_boundary.Static(level<span class="op">=</span>[<span class="fl">0.5</span>])]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>level_boundary17 <span class="op">=</span> model.level_boundary.add(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">17</span>, Point(<span class="fl">6.0</span>, <span class="fl">1.0</span>)), [level_boundary.Static(level<span class="op">=</span>[<span class="fl">1.5</span>])]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup flow boundary:</p>
<div id="2546d799" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>flow_boundary15 <span class="op">=</span> model.flow_boundary.add(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">15</span>, Point(<span class="fl">3.0</span>, <span class="fl">3.0</span>)), [flow_boundary.Static(flow_rate<span class="op">=</span>[<span class="fl">1e-4</span>])]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>flow_boundary16 <span class="op">=</span> model.flow_boundary.add(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">16</span>, Point(<span class="fl">0.0</span>, <span class="fl">1.0</span>)), [flow_boundary.Static(flow_rate<span class="op">=</span>[<span class="fl">1e-4</span>])]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup terminal:</p>
<div id="2644c8e6" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>terminal14 <span class="op">=</span> model.terminal.add(Node(<span class="dv">14</span>, Point(<span class="fl">3.0</span>, <span class="op">-</span><span class="fl">2.0</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup the links:</p>
<div id="5aa05037" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model.link.add(basin1, manning_resistance2)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>model.link.add(manning_resistance2, basin3)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>model.link.add(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    basin3,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    tabulated_rating_curve8,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>model.link.add(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    basin3,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    tabulated_rating_curve5,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>model.link.add(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    basin3,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    tabulated_rating_curve4,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>model.link.add(tabulated_rating_curve5, basin6)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>model.link.add(tabulated_rating_curve8, basin9)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>model.link.add(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    tabulated_rating_curve4,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    terminal14,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>model.link.add(basin6, pump7)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>model.link.add(pump7, basin9)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>model.link.add(basin9, linear_resistance10)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>model.link.add(level_boundary11, linear_resistance12)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>model.link.add(linear_resistance12, basin3)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>model.link.add(flow_boundary15, basin6)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>model.link.add(flow_boundary16, basin1)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>model.link.add(linear_resistance10, level_boundary17)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s take a look at the model:</p>
<div id="c5650fe6" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model.plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-17-output-1.png" width="664" height="392" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Write the model to a TOML and GeoPackage:</p>
<div id="76f61d82" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>toml_path <span class="op">=</span> datadir <span class="op">/</span> <span class="st">"basic/ribasim.toml"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>model.write(toml_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>PosixPath('data/basic/ribasim.toml')</code></pre>
</div>
</div>
<section id="running-a-model" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="running-a-model"><span class="header-section-number">1.1</span> Running a model</h2>
<p>Now run the model:</p>
<div id="10962c6f" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>run_ribasim(toml_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Starting a Ribasim simulation at 2026-02-02T10:55:14.186.
│   toml_path = "data/basic/ribasim.toml"
│   ribasim_version = "2026.1.0-rc1"
│   starttime = 2020-01-01T00:00:00
│   endtime = 2021-01-01T00:00:00
└   threads = 1
Simulating   0%|                                        |  ETA: N/A
Simulating   2%|▉                                       |  ETA: 0:40:49
Simulating   4%|█▌                                      |  ETA: 0:21:25
Simulating   6%|██▍                                     |  ETA: 0:13:52
Simulating   8%|███▍                                    |  ETA: 0:09:13
Simulating  11%|████▌                                   |  ETA: 0:06:45
Simulating  14%|█████▋                                  |  ETA: 0:05:09
Simulating  18%|███████                                 |  ETA: 0:04:01
Simulating  21%|████████▌                               |  ETA: 0:03:09
Simulating  25%|██████████▏                             |  ETA: 0:02:30
Simulating  30%|████████████                            |  ETA: 0:01:59
Simulating  36%|██████████████▌                         |  ETA: 0:01:30
Simulating  47%|██████████████████▊                     |  ETA: 0:00:58
Simulating  53%|█████████████████████▎                  |  ETA: 0:00:45
Simulating  64%|█████████████████████████▋              |  ETA: 0:00:29
Simulating  77%|██████████████████████████████▋         |  ETA: 0:00:16
Simulating  92%|████████████████████████████████████▊   |  ETA: 0:00:05
Simulating 100%|████████████████████████████████████████| Time: 0:00:51
[ Info: Computation time: 24 seconds, 878 milliseconds
[ Info: The model finished successfully at 2026-02-02T10:58:03.772.</code></pre>
</div>
</div>
<p>You can also open a terminal and run it from there. For example, to run the basic model, input:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ribasim</span> basic/ribasim.toml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>After running the model, read back the results:</p>
<div id="80190f5b" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_basin <span class="op">=</span> pd.read_feather(datadir <span class="op">/</span> <span class="st">"basic/results/basin.arrow"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df_basin_wide <span class="op">=</span> df_basin.pivot_table(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"time"</span>, columns<span class="op">=</span><span class="st">"node_id"</span>, values<span class="op">=</span>[<span class="st">"storage"</span>, <span class="st">"level"</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df_basin_wide[<span class="st">"level"</span>].plot()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"level [m]"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-20-output-1.png" width="589" height="444" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="619bd4c4" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_flow <span class="op">=</span> pd.read_feather(datadir <span class="op">/</span> <span class="st">"basic/results/flow.arrow"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df_flow[<span class="st">"link"</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(df_flow.from_node_id, df_flow.to_node_id))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df_flow[<span class="st">"flow_m3d"</span>] <span class="op">=</span> df_flow.flow_rate <span class="op">*</span> <span class="dv">86400</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df_flow.pivot_table(index<span class="op">=</span><span class="st">"time"</span>, columns<span class="op">=</span><span class="st">"link"</span>, values<span class="op">=</span><span class="st">"flow_m3d"</span>).plot()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ax.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.3</span>, <span class="dv">1</span>), title<span class="op">=</span><span class="st">"Link"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"flow [m³day⁻¹]"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-21-output-1.png" width="745" height="444" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-with-discrete-control" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Model with discrete control</h1>
<p>The model constructed below consists of a single basin which slowly drains through a <code>TabulatedRatingCurve</code>, but is held within a range by two connected pumps. These two pumps together behave like a reversible pump. When pumping can be done in only one direction, and the other direction is only possible under gravity, use an Outlet for that direction.</p>
<p>Setup the basins:</p>
<div id="e652c703" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    starttime<span class="op">=</span><span class="st">"2020-01-01"</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    endtime<span class="op">=</span><span class="st">"2021-01-01"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">"EPSG:4326"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    solver<span class="op">=</span>Solver(abstol<span class="op">=</span><span class="fl">1e-6</span>, reltol<span class="op">=</span><span class="fl">1e-5</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="42fb88e6" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model.basin.add(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">1</span>, Point(<span class="fl">0.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        basin.Profile(area<span class="op">=</span>[<span class="fl">1000.0</span>, <span class="fl">1000.0</span>], level<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>]),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        basin.State(level<span class="op">=</span>[<span class="fl">20.0</span>]),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        basin.Time(time<span class="op">=</span>[<span class="st">"2020-01-01"</span>, <span class="st">"2020-07-01"</span>], precipitation<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">3e-6</span>]),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>Basin #1</code></pre>
</div>
</div>
<p>Setup the discrete control:</p>
<div id="8773085a" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model.discrete_control.add(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">7</span>, Point(<span class="fl">1.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        discrete_control.Variable(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            compound_variable_id<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            listen_node_id<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            variable<span class="op">=</span>[<span class="st">"level"</span>],</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        discrete_control.Condition(</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>            compound_variable_id<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>            condition_id<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>            <span class="co"># min, max</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>            threshold_high<span class="op">=</span>[<span class="fl">5.0</span>, <span class="fl">15.0</span>],</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        discrete_control.Logic(</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>            truth_state<span class="op">=</span>[<span class="st">"FF"</span>, <span class="st">"TF"</span>, <span class="st">"TT"</span>],</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>            control_state<span class="op">=</span>[<span class="st">"in"</span>, <span class="st">"none"</span>, <span class="st">"out"</span>],</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>DiscreteControl #7</code></pre>
</div>
</div>
<p>The above control logic can be summarized as follows:</p>
<ul>
<li>If the level is above the maximum, activate the control state “out”;</li>
<li>If the level is below the minimum, active the control state “in”;</li>
<li>Otherwise activate the control state “none”.</li>
</ul>
<p>Setup the pump:</p>
<div id="ff0c7589" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model.pump.add(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">2</span>, Point(<span class="fl">1.0</span>, <span class="fl">1.0</span>)),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    [pump.Static(control_state<span class="op">=</span>[<span class="st">"none"</span>, <span class="st">"in"</span>, <span class="st">"out"</span>], flow_rate<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">2e-3</span>, <span class="fl">0.0</span>])],</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>model.pump.add(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">3</span>, Point(<span class="fl">1.0</span>, <span class="op">-</span><span class="fl">1.0</span>)),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    [pump.Static(control_state<span class="op">=</span>[<span class="st">"none"</span>, <span class="st">"in"</span>, <span class="st">"out"</span>], flow_rate<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">2e-3</span>])],</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>Pump #3</code></pre>
</div>
</div>
<p>The pump data defines the following:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Control state</th>
<th>Pump #2 flow rate (m/s)</th>
<th>Pump #3 flow rate (m/s)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“none”</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>“in”</td>
<td>2e-3</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>“out”</td>
<td>0.0</td>
<td>2e-3</td>
</tr>
</tbody>
</table>
<p>Setup the level boundary:</p>
<div id="a4f758a5" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model.level_boundary.add(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">4</span>, Point(<span class="fl">2.0</span>, <span class="fl">0.0</span>)), [level_boundary.Static(level<span class="op">=</span>[<span class="fl">10.0</span>])]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>LevelBoundary #4</code></pre>
</div>
</div>
<p>Setup the rating curve:</p>
<div id="83018535" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model.tabulated_rating_curve.add(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">5</span>, Point(<span class="op">-</span><span class="fl">1.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    [tabulated_rating_curve.Static(level<span class="op">=</span>[<span class="fl">2.0</span>, <span class="fl">15.0</span>], flow_rate<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">2e-3</span>])],</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>TabulatedRatingCurve #5</code></pre>
</div>
</div>
<p>Setup the terminal:</p>
<div id="bbdcf592" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model.terminal.add(Node(<span class="dv">6</span>, Point(<span class="op">-</span><span class="fl">2.0</span>, <span class="fl">0.0</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>Terminal #6</code></pre>
</div>
</div>
<p>Setup links:</p>
<div id="72fb2595" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>model.link.add(model.basin[<span class="dv">1</span>], model.pump[<span class="dv">3</span>])</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>model.link.add(model.pump[<span class="dv">3</span>], model.level_boundary[<span class="dv">4</span>])</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>model.link.add(model.level_boundary[<span class="dv">4</span>], model.pump[<span class="dv">2</span>])</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>model.link.add(model.pump[<span class="dv">2</span>], model.basin[<span class="dv">1</span>])</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>model.link.add(model.basin[<span class="dv">1</span>], model.tabulated_rating_curve[<span class="dv">5</span>])</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>model.link.add(model.tabulated_rating_curve[<span class="dv">5</span>], model.terminal[<span class="dv">6</span>])</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>model.link.add(model.discrete_control[<span class="dv">7</span>], model.pump[<span class="dv">2</span>])</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>model.link.add(model.discrete_control[<span class="dv">7</span>], model.pump[<span class="dv">3</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s take a look at the model:</p>
<div id="145d67a9" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>model.plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-30-output-1.png" width="742" height="337" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Listen links are plotted with a dashed line since they are not present in the “Link / static” schema but only in the “Control / condition” schema.</p>
<div id="6b93d008" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span> Path(<span class="st">"data"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>model.write(datadir <span class="op">/</span> <span class="st">"level_range/ribasim.toml"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>PosixPath('data/level_range/ribasim.toml')</code></pre>
</div>
</div>
<p>Now run the model.</p>
<div id="d4b95b46" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>run_ribasim(datadir <span class="op">/</span> <span class="st">"level_range/ribasim.toml"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Starting a Ribasim simulation at 2026-02-02T10:58:05.628.
│   toml_path = "data/level_range/ribasim.toml"
│   ribasim_version = "2026.1.0-rc1"
│   starttime = 2020-01-01T00:00:00
│   endtime = 2021-01-01T00:00:00
└   threads = 1
Simulating   0%|                                        |  ETA: N/A
Simulating  17%|██████▋                                 |  ETA: 0:00:04
Simulating  44%|█████████████████▋                      |  ETA: 0:00:01
Simulating  65%|██████████████████████████▏             |  ETA: 0:00:00
Simulating  66%|██████████████████████████▌             |  ETA: 0:00:00
Simulating  66%|██████████████████████████▌             |  ETA: 0:00:00
Simulating  66%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  66%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  66%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▋             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▊             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|██████████████████████████▉             |  ETA: 0:00:00
Simulating  67%|███████████████████████████             |  ETA: 0:00:00
Simulating  67%|███████████████████████████             |  ETA: 0:00:00
Simulating  67%|███████████████████████████             |  ETA: 0:00:00
Simulating  67%|███████████████████████████             |  ETA: 0:00:00
Simulating  67%|███████████████████████████             |  ETA: 0:00:00
Simulating  67%|███████████████████████████             |  ETA: 0:00:00
Simulating  67%|███████████████████████████             |  ETA: 0:00:00
Simulating  68%|███████████████████████████             |  ETA: 0:00:00
Simulating  68%|███████████████████████████             |  ETA: 0:00:00
Simulating  68%|███████████████████████████             |  ETA: 0:00:00
Simulating  68%|███████████████████████████             |  ETA: 0:00:01
Simulating  68%|███████████████████████████             |  ETA: 0:00:01
Simulating  68%|███████████████████████████             |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▏            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▎            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▎            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▎            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▎            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▎            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▎            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▎            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  68%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▍            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▌            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▌            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▌            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▌            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▌            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▌            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▌            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▋            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▋            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▋            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▋            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▋            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▋            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▋            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▊            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▊            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▊            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▊            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▊            |  ETA: 0:00:01
Simulating  69%|███████████████████████████▊            |  ETA: 0:00:01
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:01
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:01
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:01
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:01
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:01
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:01
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:01
Simulating  70%|████████████████████████████            |  ETA: 0:00:01
Simulating  70%|████████████████████████████            |  ETA: 0:00:01
Simulating  70%|████████████████████████████            |  ETA: 0:00:01
Simulating  70%|████████████████████████████            |  ETA: 0:00:01
Simulating  70%|████████████████████████████            |  ETA: 0:00:01
Simulating  70%|████████████████████████████            |  ETA: 0:00:01
Simulating  70%|████████████████████████████▏           |  ETA: 0:00:01
Simulating  70%|████████████████████████████▏           |  ETA: 0:00:01
Simulating  70%|████████████████████████████▏           |  ETA: 0:00:01
Simulating  70%|████████████████████████████▏           |  ETA: 0:00:01
Simulating  70%|████████████████████████████▏           |  ETA: 0:00:01
Simulating  70%|████████████████████████████▏           |  ETA: 0:00:01
Simulating  70%|████████████████████████████▎           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▎           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▎           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▎           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▎           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▎           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▍           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▌           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▌           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▌           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▌           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▌           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▌           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▋           |  ETA: 0:00:01
Simulating  71%|████████████████████████████▋           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▋           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▋           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▋           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▋           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▊           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|████████████████████████████▉           |  ETA: 0:00:01
Simulating  72%|█████████████████████████████           |  ETA: 0:00:01
Simulating  72%|█████████████████████████████           |  ETA: 0:00:01
Simulating  72%|█████████████████████████████           |  ETA: 0:00:01
Simulating  73%|█████████████████████████████           |  ETA: 0:00:01
Simulating  73%|█████████████████████████████           |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▏          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▏          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▏          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▏          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▏          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▏          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▎          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▎          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▎          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▎          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▎          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▎          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▍          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▍          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▍          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▍          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▍          |  ETA: 0:00:01
Simulating  73%|█████████████████████████████▍          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▍          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▌          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▌          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▌          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▌          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▌          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▋          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▋          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▋          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▋          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▋          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▊          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▊          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▊          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▊          |  ETA: 0:00:01
Simulating  74%|█████████████████████████████▊          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|█████████████████████████████▉          |  ETA: 0:00:01
Simulating  75%|██████████████████████████████          |  ETA: 0:00:01
Simulating  75%|██████████████████████████████          |  ETA: 0:00:01
Simulating  75%|██████████████████████████████          |  ETA: 0:00:01
Simulating  75%|██████████████████████████████          |  ETA: 0:00:01
Simulating  75%|██████████████████████████████          |  ETA: 0:00:01
Simulating  75%|██████████████████████████████▏         |  ETA: 0:00:01
Simulating  75%|██████████████████████████████▏         |  ETA: 0:00:01
Simulating  75%|██████████████████████████████▏         |  ETA: 0:00:01
Simulating  75%|██████████████████████████████▏         |  ETA: 0:00:01
Simulating  75%|██████████████████████████████▎         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▎         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▎         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▎         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▎         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▍         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▍         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▍         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▍         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▌         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▌         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▌         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▌         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▌         |  ETA: 0:00:01
Simulating  76%|██████████████████████████████▋         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▋         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▋         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▋         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▊         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▊         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▊         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▊         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▉         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▉         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▉         |  ETA: 0:00:01
Simulating  77%|██████████████████████████████▉         |  ETA: 0:00:01
Simulating  77%|███████████████████████████████         |  ETA: 0:00:01
Simulating  77%|███████████████████████████████         |  ETA: 0:00:01
Simulating  78%|███████████████████████████████         |  ETA: 0:00:01
Simulating  78%|███████████████████████████████         |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▏        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▏        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▏        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▏        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▏        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▎        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▎        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▎        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▍        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▍        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▍        |  ETA: 0:00:01
Simulating  78%|███████████████████████████████▍        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▍        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▍        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▌        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▌        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▌        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▌        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▋        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▋        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▋        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▋        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▊        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▊        |  ETA: 0:00:01
Simulating  79%|███████████████████████████████▊        |  ETA: 0:00:01
Simulating  80%|███████████████████████████████▊        |  ETA: 0:00:01
Simulating  80%|███████████████████████████████▉        |  ETA: 0:00:01
Simulating  80%|███████████████████████████████▉        |  ETA: 0:00:01
Simulating  80%|███████████████████████████████▉        |  ETA: 0:00:01
Simulating  80%|████████████████████████████████        |  ETA: 0:00:01
Simulating  80%|████████████████████████████████        |  ETA: 0:00:01
Simulating  80%|████████████████████████████████        |  ETA: 0:00:01
Simulating  80%|████████████████████████████████        |  ETA: 0:00:01
Simulating  80%|████████████████████████████████▏       |  ETA: 0:00:01
Simulating  80%|████████████████████████████████▏       |  ETA: 0:00:01
Simulating  80%|████████████████████████████████▏       |  ETA: 0:00:01
Simulating  80%|████████████████████████████████▎       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▎       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▎       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▎       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▍       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▍       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▍       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▌       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▌       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▌       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▌       |  ETA: 0:00:01
Simulating  81%|████████████████████████████████▋       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▋       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▋       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▊       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▊       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▊       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▉       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▉       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▉       |  ETA: 0:00:01
Simulating  82%|████████████████████████████████▉       |  ETA: 0:00:01
Simulating  82%|█████████████████████████████████       |  ETA: 0:00:01
Simulating  82%|█████████████████████████████████       |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████       |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████       |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▏      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▏      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▏      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▏      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▎      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▎      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▎      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▎      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▎      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▍      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▍      |  ETA: 0:00:01
Simulating  83%|█████████████████████████████████▍      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▍      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▍      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▌      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▌      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▌      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▌      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▋      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▋      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▋      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▋      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▊      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▊      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▊      |  ETA: 0:00:01
Simulating  84%|█████████████████████████████████▊      |  ETA: 0:00:01
Simulating  85%|█████████████████████████████████▉      |  ETA: 0:00:01
Simulating  85%|█████████████████████████████████▉      |  ETA: 0:00:00
Simulating  85%|█████████████████████████████████▉      |  ETA: 0:00:00
Simulating  85%|█████████████████████████████████▉      |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████      |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████      |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████      |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████      |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████▏     |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████▏     |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████▏     |  ETA: 0:00:00
Simulating  85%|██████████████████████████████████▏     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▎     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▎     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▎     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▍     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▍     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▍     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▌     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▌     |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▌     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▋     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▋     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▊     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▊     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▊     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▉     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▉     |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▉     |  ETA: 0:00:00
Simulating  87%|███████████████████████████████████     |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████     |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████     |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████▏    |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████▏    |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████▏    |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████▎    |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████▎    |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████▍    |  ETA: 0:00:00
Simulating  88%|███████████████████████████████████▍    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▍    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▌    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▌    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▌    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▋    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▋    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▊    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▊    |  ETA: 0:00:00
Simulating  89%|███████████████████████████████████▊    |  ETA: 0:00:00
Simulating  90%|███████████████████████████████████▉    |  ETA: 0:00:00
Simulating  90%|███████████████████████████████████▉    |  ETA: 0:00:00
Simulating  90%|███████████████████████████████████▉    |  ETA: 0:00:00
Simulating  90%|███████████████████████████████████▉    |  ETA: 0:00:00
Simulating  90%|████████████████████████████████████    |  ETA: 0:00:00
Simulating  90%|████████████████████████████████████    |  ETA: 0:00:00
Simulating  90%|████████████████████████████████████    |  ETA: 0:00:00
Simulating  90%|████████████████████████████████████▏   |  ETA: 0:00:00
Simulating  90%|████████████████████████████████████▏   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▎   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▎   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▍   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▍   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▍   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▌   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▌   |  ETA: 0:00:00
Simulating  91%|████████████████████████████████████▋   |  ETA: 0:00:00
Simulating  92%|████████████████████████████████████▋   |  ETA: 0:00:00
Simulating  92%|████████████████████████████████████▊   |  ETA: 0:00:00
Simulating  92%|████████████████████████████████████▊   |  ETA: 0:00:00
Simulating  92%|████████████████████████████████████▊   |  ETA: 0:00:00
Simulating  92%|████████████████████████████████████▉   |  ETA: 0:00:00
Simulating  92%|████████████████████████████████████▉   |  ETA: 0:00:00
Simulating  92%|█████████████████████████████████████   |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████   |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████▏  |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████▏  |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████▏  |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████▎  |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████▎  |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████▍  |  ETA: 0:00:00
Simulating  93%|█████████████████████████████████████▍  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▌  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▌  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▌  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▋  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▋  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▊  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▊  |  ETA: 0:00:00
Simulating  94%|█████████████████████████████████████▊  |  ETA: 0:00:00
Simulating  95%|█████████████████████████████████████▉  |  ETA: 0:00:00
Simulating  95%|█████████████████████████████████████▉  |  ETA: 0:00:00
Simulating  95%|█████████████████████████████████████▉  |  ETA: 0:00:00
Simulating  95%|█████████████████████████████████████▉  |  ETA: 0:00:00
Simulating  95%|██████████████████████████████████████  |  ETA: 0:00:00
Simulating  95%|██████████████████████████████████████  |  ETA: 0:00:00
Simulating  95%|██████████████████████████████████████▏ |  ETA: 0:00:00
Simulating  95%|██████████████████████████████████████▏ |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▎ |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▎ |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▍ |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▍ |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▌ |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▌ |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▌ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▋ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▋ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▋ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▊ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▊ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▊ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▊ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▉ |  ETA: 0:00:00
Simulating  97%|██████████████████████████████████████▉ |  ETA: 0:00:00
Simulating  97%|███████████████████████████████████████ |  ETA: 0:00:00
Simulating  98%|███████████████████████████████████████ |  ETA: 0:00:00
Simulating  98%|███████████████████████████████████████▏|  ETA: 0:00:00
Simulating  98%|███████████████████████████████████████▏|  ETA: 0:00:00
Simulating  98%|███████████████████████████████████████▎|  ETA: 0:00:00
Simulating  98%|███████████████████████████████████████▎|  ETA: 0:00:00
Simulating  98%|███████████████████████████████████████▍|  ETA: 0:00:00
Simulating  98%|███████████████████████████████████████▍|  ETA: 0:00:00
Simulating  99%|███████████████████████████████████████▌|  ETA: 0:00:00
Simulating  99%|███████████████████████████████████████▌|  ETA: 0:00:00
Simulating  99%|███████████████████████████████████████▌|  ETA: 0:00:00
Simulating  99%|███████████████████████████████████████▋|  ETA: 0:00:00
Simulating  99%|███████████████████████████████████████▋|  ETA: 0:00:00
Simulating  99%|███████████████████████████████████████▊|  ETA: 0:00:00
Simulating  99%|███████████████████████████████████████▊|  ETA: 0:00:00
Simulating 100%|███████████████████████████████████████▉|  ETA: 0:00:00
Simulating 100%|███████████████████████████████████████▉|  ETA: 0:00:00
Simulating 100%|████████████████████████████████████████|  ETA: 0:00:00
Simulating 100%|████████████████████████████████████████|  ETA: 0:00:00
Simulating 100%|████████████████████████████████████████| Time: 0:00:03
[ Info: Computation time: 3 seconds, 508 milliseconds
[ Info: The model finished successfully at 2026-02-02T10:58:15.520.</code></pre>
</div>
</div>
<p>After running the model, read back the results:</p>
<div id="39ec2e02" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_basin <span class="op">=</span> pd.read_feather(datadir <span class="op">/</span> <span class="st">"level_range/results/basin.arrow"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_basin_wide <span class="op">=</span> df_basin.pivot_table(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"time"</span>, columns<span class="op">=</span><span class="st">"node_id"</span>, values<span class="op">=</span>[<span class="st">"storage"</span>, <span class="st">"level"</span>]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df_basin_wide[<span class="st">"level"</span>].plot()</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>threshold_high <span class="op">=</span> model.discrete_control.condition.df.threshold_high</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>ax.hlines(</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    threshold_high,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    df_basin.time[<span class="dv">0</span>],</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    df_basin.time.<span class="bu">max</span>(),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    lw<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    ls<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"k"</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(threshold_high, [<span class="st">"min"</span>, <span class="st">"max"</span>])</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"level"</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-33-output-1.png" width="597" height="444" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We see that in January the level of the basin is too high and thus water is pumped out until the maximum level of the desired range is reached. Then until May water flows out of the basin freely through the tabulated rating curve until the minimum level is reached. From this point until the start of July water is pumped into the basin in short bursts to stay within the desired range. At the start of July rain starts falling on the basin, which causes the basin level to rise until the maximum level. From this point onward water is pumped out of the basin in short bursts to stay within the desired range.</p>
</section>
<section id="model-with-pid-control" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Model with PID control</h1>
<p>Set up the model:</p>
<div id="bcc8368a" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(starttime<span class="op">=</span><span class="st">"2020-01-01"</span>, endtime<span class="op">=</span><span class="st">"2020-12-01"</span>, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup the basins:</p>
<div id="27d4e5a0" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>model.basin.add(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">2</span>, Point(<span class="fl">1.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    [basin.Profile(area<span class="op">=</span>[<span class="fl">1000.0</span>, <span class="fl">1000.0</span>], level<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>]), basin.State(level<span class="op">=</span>[<span class="fl">6.0</span>])],</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>Basin #2</code></pre>
</div>
</div>
<p>Setup the pump:</p>
<div id="05eb67eb" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>model.pump.add(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">3</span>, Point(<span class="fl">2.0</span>, <span class="fl">0.5</span>)),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    [pump.Static(flow_rate<span class="op">=</span>[<span class="fl">0.0</span>])],  <span class="co"># Will be overwritten by PID controller</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>Pump #3</code></pre>
</div>
</div>
<p>Setup the outlet:</p>
<div id="1670e895" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>model.outlet.add(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">6</span>, Point(<span class="fl">2.0</span>, <span class="op">-</span><span class="fl">0.5</span>)),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    [outlet.Static(flow_rate<span class="op">=</span>[<span class="fl">0.0</span>])],  <span class="co"># Will be overwritten by PID controller</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>Outlet #6</code></pre>
</div>
</div>
<p>Setup flow boundary:</p>
<div id="bbb180b2" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>model.flow_boundary.add(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">1</span>, Point(<span class="fl">0.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    [flow_boundary.Static(flow_rate<span class="op">=</span>[<span class="fl">1e-3</span>])],</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>FlowBoundary #1</code></pre>
</div>
</div>
<p>Setup level boundary:</p>
<div id="54099df6" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>model.level_boundary.add(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">4</span>, Point(<span class="fl">3.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    [level_boundary.Static(level<span class="op">=</span>[<span class="fl">5.0</span>])],</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>LevelBoundary #4</code></pre>
</div>
</div>
<p>Setup PID control:</p>
<div id="9cd4aa60" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node, proportional, integral <span class="kw">in</span> [</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    (Node(<span class="dv">5</span>, Point(<span class="fl">1.5</span>, <span class="fl">1.0</span>)), <span class="op">-</span><span class="fl">1e-3</span>, <span class="op">-</span><span class="fl">1e-7</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    (Node(<span class="dv">7</span>, Point(<span class="fl">1.5</span>, <span class="op">-</span><span class="fl">1.0</span>)), <span class="fl">1e-3</span>, <span class="fl">1e-7</span>),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    pid_control_data <span class="op">=</span> [</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        pid_control.Time(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>            time<span class="op">=</span>[</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"2020-01-01"</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"2020-05-01"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"2020-07-01"</span>,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"2020-12-01"</span>,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>            listen_node_id<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>            target<span class="op">=</span>[<span class="fl">5.0</span>, <span class="fl">5.0</span>, <span class="fl">7.5</span>, <span class="fl">7.5</span>],</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>            proportional<span class="op">=</span>proportional,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>            integral<span class="op">=</span>integral,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>            derivative<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    model.pid_control.add(node, pid_control_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Note that the coefficients for the pump and the outlet are equal in magnitude but opposite in sign. This way the pump and the outlet equally work towards the same goal, while having opposite effects on the controlled basin due to their connectivity to this basin.</p>
<p>Setup the links:</p>
<div id="ba6c72c2" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>model.link.add(model.flow_boundary[<span class="dv">1</span>], model.basin[<span class="dv">2</span>])</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>model.link.add(model.basin[<span class="dv">2</span>], model.pump[<span class="dv">3</span>])</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>model.link.add(model.pump[<span class="dv">3</span>], model.level_boundary[<span class="dv">4</span>])</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>model.link.add(model.level_boundary[<span class="dv">4</span>], model.outlet[<span class="dv">6</span>])</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>model.link.add(model.outlet[<span class="dv">6</span>], model.basin[<span class="dv">2</span>])</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>model.link.add(model.pid_control[<span class="dv">5</span>], model.pump[<span class="dv">3</span>])</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>model.link.add(model.pid_control[<span class="dv">7</span>], model.outlet[<span class="dv">6</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s take a look at the model:</p>
<div id="a26f24a0" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>model.plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-42-output-1.png" width="694" height="380" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Write the model to a TOML and GeoPackage:</p>
<div id="4faa3bbd" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span> Path(<span class="st">"data"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>model.write(datadir <span class="op">/</span> <span class="st">"pid_control/ribasim.toml"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>PosixPath('data/pid_control/ribasim.toml')</code></pre>
</div>
</div>
<p>Now run the model.</p>
<div id="a4d8835d" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>run_ribasim(datadir <span class="op">/</span> <span class="st">"pid_control/ribasim.toml"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Starting a Ribasim simulation at 2026-02-02T10:58:16.493.
│   toml_path = "data/pid_control/ribasim.toml"
│   ribasim_version = "2026.1.0-rc1"
│   starttime = 2020-01-01T00:00:00
│   endtime = 2020-12-01T00:00:00
└   threads = 1
Simulating   0%|                                        |  ETA: N/A
Simulating   2%|▋                                       |  ETA: 0:00:00
Simulating   4%|█▌                                      |  ETA: 0:00:00
Simulating   6%|██▍                                     |  ETA: 0:00:00
Simulating   8%|███▍                                    |  ETA: 0:00:00
Simulating  11%|████▌                                   |  ETA: 0:00:00
Simulating  16%|██████▎                                 |  ETA: 0:00:00
Simulating  20%|████████▏                               |  ETA: 0:00:00
Simulating  25%|██████████▏                             |  ETA: 0:00:00
Simulating  31%|████████████▌                           |  ETA: 0:00:00
Simulating  37%|██████████████▊                         |  ETA: 0:00:00
Simulating  42%|████████████████▊                       |  ETA: 0:00:00
Simulating  47%|██████████████████▉                     |  ETA: 0:00:00
Simulating  53%|█████████████████████                   |  ETA: 0:00:00
Simulating  57%|██████████████████████▉                 |  ETA: 0:00:00
Simulating  63%|█████████████████████████▏              |  ETA: 0:00:00
Simulating  70%|███████████████████████████▉            |  ETA: 0:00:00
Simulating  77%|██████████████████████████████▊         |  ETA: 0:00:00
Simulating  86%|██████████████████████████████████▌     |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▌ |  ETA: 0:00:00
Simulating 100%|████████████████████████████████████████| Time: 0:00:00
[ Info: Computation time: 172 milliseconds
[ Info: The model finished successfully at 2026-02-02T10:58:19.808.</code></pre>
</div>
</div>
<p>After running the model, read back the results:</p>
<div id="500abd89" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.dates <span class="im">import</span> date2num</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>df_basin <span class="op">=</span> pd.read_feather(datadir <span class="op">/</span> <span class="st">"pid_control/results/basin.arrow"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>df_basin_wide <span class="op">=</span> df_basin.pivot_table(</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"time"</span>, columns<span class="op">=</span><span class="st">"node_id"</span>, values<span class="op">=</span>[<span class="st">"storage"</span>, <span class="st">"level"</span>]</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df_basin_wide[<span class="st">"level"</span>].plot()</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"level [m]"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot target level</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>level_demands <span class="op">=</span> model.pid_control.time.df.target.to_numpy()[:<span class="dv">4</span>]</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> date2num(model.pid_control.time.df.time)[:<span class="dv">4</span>]</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>ax.plot(times, level_demands, color<span class="op">=</span><span class="st">"k"</span>, ls<span class="op">=</span><span class="st">":"</span>, label<span class="op">=</span><span class="st">"target level"</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="cf">pass</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-45-output-1.png" width="589" height="444" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="polderboezem-water-management-with-allocation" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Polder/Boezem water management with allocation</h1>
<p><strong>Situation description</strong>: This example demonstrates a typical Dutch polder and boezem (storage basin) system that uses allocation to maintain target water levels under varying hydrological conditions. The model includes two polder basins at different elevations and two connected boezem basins, with controlled flows between them.</p>
<p>In the Netherlands, polders are low-lying areas protected by dikes, typically with water levels maintained below the surrounding area. The boezem is a higher water system that collects water from multiple polders and manages water distribution. This hierarchy requires careful water management through pumps, outlets, and controlled structures.</p>
<p><strong>Model approach</strong>: The model uses Ribasim’s allocation feature to intelligently manage water distribution during both wet and dry seasons. The system experiences:</p>
<ul>
<li><strong>Wet periods</strong> (days 1-90 and 180-270): Precipitation exceeds evaporation, requiring water removal from polders</li>
<li><strong>Dry periods</strong> (days 90-180 and 270-366): Evaporation exceeds precipitation, requiring water supply to maintain target levels</li>
</ul>
<p>Setup the model with allocation enabled:</p>
<div id="f13403a4" class="cell" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ribasim.nodes <span class="im">import</span> (</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    flow_demand</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    starttime<span class="op">=</span><span class="st">"2020-01-01"</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    endtime<span class="op">=</span><span class="st">"2021-01-01"</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">"EPSG:4326"</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    experimental<span class="op">=</span>Experimental(allocation<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Create time-varying precipitation and evaporation patterns:</p>
<div id="f80326e1" class="cell" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> pd.date_range(model.starttime, model.endtime)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>day_of_year <span class="op">=</span> time.day_of_year.to_numpy()</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>precipitation <span class="op">=</span> np.zeros(day_of_year.size)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>precipitation[<span class="dv">0</span>:<span class="dv">90</span>] <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>precipitation[<span class="dv">90</span>:<span class="dv">180</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>precipitation[<span class="dv">180</span>:<span class="dv">270</span>] <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>precipitation[<span class="dv">270</span>:<span class="dv">366</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>evaporation <span class="op">=</span> np.zeros(day_of_year.size)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>evaporation[<span class="dv">0</span>:<span class="dv">90</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>evaporation[<span class="dv">90</span>:<span class="dv">180</span>] <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>evaporation[<span class="dv">180</span>:<span class="dv">270</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>evaporation[<span class="dv">270</span>:<span class="dv">366</span>] <span class="op">=</span> <span class="fl">1e-6</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup the basins with identical profiles and forcing:</p>
<div id="63f7ed25" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>basin_data <span class="op">=</span> [</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    basin.Profile(area<span class="op">=</span>[<span class="fl">0.01</span>, <span class="fl">1000000.0</span>], level<span class="op">=</span>[<span class="op">-</span><span class="dv">10</span>, <span class="fl">2.0</span>]),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    basin.Time(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>        time<span class="op">=</span>time,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>        drainage<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>        potential_evaporation<span class="op">=</span>evaporation,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        infiltration<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        precipitation<span class="op">=</span>precipitation,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    basin.State(level<span class="op">=</span>[<span class="fl">0.9</span>]),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>basin3 <span class="op">=</span> model.basin.add(Node(<span class="dv">3</span>, Point(<span class="fl">2.0</span>, <span class="fl">0.0</span>), name<span class="op">=</span><span class="st">"Boezem"</span>), basin_data)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>basin4 <span class="op">=</span> model.basin.add(Node(<span class="dv">4</span>, Point(<span class="fl">2.0</span>, <span class="fl">2.0</span>), name<span class="op">=</span><span class="st">"Polder"</span>), basin_data)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>basin6 <span class="op">=</span> model.basin.add(Node(<span class="dv">6</span>, Point(<span class="fl">4.0</span>, <span class="fl">2.0</span>), name<span class="op">=</span><span class="st">"Polder"</span>), basin_data)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>basin9 <span class="op">=</span> model.basin.add(Node(<span class="dv">9</span>, Point(<span class="fl">4.0</span>, <span class="fl">0.0</span>), name<span class="op">=</span><span class="st">"Boezem"</span>), basin_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The key to this model is using <code>LevelDemand</code> nodes to specify target levels for each polder and the boezem. The allocation algorithm will automatically determine required flows:</p>
<div id="a7c93077" class="cell" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Level demand on polder 4: maintain exactly 1.0 m</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>level4 <span class="op">=</span> model.level_demand.add(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">100</span>, Point(<span class="fl">2.0</span>, <span class="fl">2.5</span>), name<span class="op">=</span><span class="st">"polder#4 level demand"</span>),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    [level_demand.Static(min_level<span class="op">=</span>[<span class="fl">1.0</span>], max_level<span class="op">=</span>[<span class="fl">1.0</span>], demand_priority<span class="op">=</span>[<span class="dv">1</span>])],</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Level demand on polder 6: maintain exactly 0.9 m</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>level6 <span class="op">=</span> model.level_demand.add(</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">101</span>, Point(<span class="fl">4.0</span>, <span class="fl">2.5</span>), name<span class="op">=</span><span class="st">"polder#6 level demand"</span>),</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    [level_demand.Static(min_level<span class="op">=</span>[<span class="fl">0.9</span>], max_level<span class="op">=</span>[<span class="fl">0.9</span>], demand_priority<span class="op">=</span>[<span class="dv">1</span>])],</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Level demand on boezem 3: maintain 1.2 m</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>level3 <span class="op">=</span> model.level_demand.add(</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">102</span>, Point(<span class="fl">2.0</span>, <span class="op">-</span><span class="dv">1</span>), name<span class="op">=</span><span class="st">"boezem#3 level demand"</span>),</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    [level_demand.Static(min_level<span class="op">=</span>[<span class="fl">1.2</span>], max_level<span class="op">=</span>[<span class="fl">1.2</span>], demand_priority<span class="op">=</span>[<span class="dv">1</span>])],</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set initial boezem levels to 1.2m</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>model.basin.state.df.loc[model.basin.state.df.node_id<span class="op">==</span><span class="dv">3</span>, <span class="st">'level'</span>] <span class="op">=</span> <span class="fl">1.2</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>model.basin.state.df.loc[model.basin.state.df.node_id<span class="op">==</span><span class="dv">9</span>, <span class="st">'level'</span>] <span class="op">=</span> <span class="fl">1.2</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>model.link.add(level4, basin4)</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>model.link.add(level6, basin6)</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>model.link.add(level3, basin3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup level boundaries representing external water systems:</p>
<div id="5f8f0cf3" class="cell" data-execution_count="49">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>level_boundary11 <span class="op">=</span> model.level_boundary.add(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">11</span>, Point(<span class="dv">0</span>, <span class="dv">0</span>)), [level_boundary.Static(level<span class="op">=</span>[<span class="dv">10</span>])]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>level_boundary17 <span class="op">=</span> model.level_boundary.add(</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">17</span>, Point(<span class="dv">6</span>, <span class="dv">0</span>)), [level_boundary.Static(level<span class="op">=</span>[<span class="fl">0.9</span>])]</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup outlets with allocation control. Note <code>control_state="Ribasim.allocation"</code> which tells the allocation algorithm to control these nodes:</p>
<div id="487772b3" class="cell" data-execution_count="50">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inlet from boezem to polder 4</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>outlet5 <span class="op">=</span> model.outlet.add(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">5</span>, Point(<span class="dv">2</span>, <span class="dv">1</span>), name<span class="op">=</span><span class="st">"inlaat"</span>),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        outlet.Static(</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            control_state<span class="op">=</span><span class="st">"Ribasim.allocation"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>            flow_rate<span class="op">=</span>[<span class="fl">0.0</span>],</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>            max_flow_rate<span class="op">=</span><span class="fl">5.0</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Bidirectional flow between polders</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>outlet13 <span class="op">=</span> model.outlet.add(</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">13</span>, Point(<span class="dv">3</span>, <span class="dv">2</span>), name<span class="op">=</span><span class="st">"inlaat/uitlaat"</span>),</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>        outlet.Static(</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>            control_state<span class="op">=</span><span class="st">"Ribasim.allocation"</span>,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>            flow_rate<span class="op">=</span>[<span class="fl">0.0</span>],</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>            max_flow_rate<span class="op">=</span><span class="fl">5.0</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Allocation-controlled outlets for water balance management</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>outlet10 <span class="op">=</span> model.outlet.add(</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">10</span>, Point(<span class="fl">5.0</span>, <span class="fl">0.0</span>)),</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    [outlet.Static(</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>        control_state<span class="op">=</span><span class="st">"Ribasim.allocation"</span>,</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>        flow_rate<span class="op">=</span>[<span class="fl">0.0</span>],</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>        max_flow_rate<span class="op">=</span><span class="dv">10</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>    )],</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>outlet12 <span class="op">=</span> model.outlet.add(</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">12</span>, Point(<span class="fl">1.0</span>, <span class="dv">0</span>)),</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>    [outlet.Static(</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>        control_state<span class="op">=</span><span class="st">"Ribasim.allocation"</span>,</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>        flow_rate<span class="op">=</span>[<span class="fl">0.0</span>],</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>        max_flow_rate<span class="op">=</span><span class="fl">10.0</span>)],</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup a pump controlled by allocation for removing excess water:</p>
<div id="fd335ac7" class="cell" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pump7 <span class="op">=</span> model.pump.add(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">7</span>, Point(<span class="dv">4</span>, <span class="dv">1</span>), name<span class="op">=</span><span class="st">"drainage pumping station"</span>),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        pump.Static(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>            control_state<span class="op">=</span><span class="st">"Ribasim.allocation"</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>            flow_rate<span class="op">=</span>[<span class="fl">0.0</span>],</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>            max_flow_rate<span class="op">=</span><span class="fl">20.0</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Add a flushing demand (water quality management) during day 90-180:</p>
<div id="166e7659" class="cell" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> pd.date_range(model.starttime, model.endtime, freq<span class="op">=</span><span class="st">"D"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> np.zeros(<span class="bu">len</span>(t))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>d[<span class="dv">90</span>:<span class="dv">180</span>] <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>pump7_alloc <span class="op">=</span> model.flow_demand.add(</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">70</span>, Point(<span class="fl">5.0</span>, <span class="dv">1</span>), name<span class="op">=</span><span class="st">"flush=1.5m3/s"</span>),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>        flow_demand.Time(</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>            time<span class="op">=</span>t,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>            demand_priority<span class="op">=</span>[<span class="dv">2</span>] <span class="op">*</span> <span class="bu">len</span>(t),</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>            demand<span class="op">=</span>d,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>model.link.add(pump7_alloc, pump7)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup Manning resistance to model open channel flow. The <code>route_priority=0</code> ensures this is the main water route:</p>
<div id="880a44f3" class="cell" data-execution_count="53">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>manning_resistance2 <span class="op">=</span> model.manning_resistance.add(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">2</span>, Point(<span class="dv">3</span>, <span class="fl">0.0</span>), route_priority<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        manning_resistance.Static(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>            length<span class="op">=</span>[<span class="dv">900</span>], manning_n<span class="op">=</span>[<span class="fl">0.04</span>], profile_width<span class="op">=</span>[<span class="fl">6.0</span>], profile_slope<span class="op">=</span>[<span class="fl">3.0</span>]</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Setup the links to connect all components:</p>
<div id="872c5f84" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>model.link.add(level_boundary11, outlet12)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>model.link.add(outlet12, basin3)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>model.link.add(basin3, outlet5)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>model.link.add(outlet5, basin4)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>model.link.add(basin4, outlet13)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>model.link.add(outlet13, basin6)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>model.link.add(basin6, pump7)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>model.link.add(pump7, basin9)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>model.link.add(basin3, manning_resistance2)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>model.link.add(manning_resistance2, basin9)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>model.link.add(basin9, outlet10)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>model.link.add(outlet10, level_boundary17)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s visualize the model structure:</p>
<div id="1989f0ad" class="cell" data-execution_count="55">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>model.plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-56-output-1.png" width="724" height="359" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Write and run the model:</p>
<div id="f84c23d5" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span> Path(<span class="st">"data"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>model.write(datadir <span class="op">/</span> <span class="st">"polder_management/ribasim.toml"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>run_ribasim(datadir <span class="op">/</span> <span class="st">"polder_management/ribasim.toml"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Starting a Ribasim simulation at 2026-02-02T10:58:21.425.
│   toml_path = "data/polder_management/ribasim.toml"
│   ribasim_version = "2026.1.0-rc1"
│   starttime = 2020-01-01T00:00:00
│   endtime = 2021-01-01T00:00:00
└   threads = 1
┌ Warning: The following experimental features are enabled: allocation
└ @ Ribasim /home/runner/work/Ribasim/Ribasim/core/src/logging.jl:53
Simulating   0%|                                        |  ETA: N/A
Simulating   4%|█▊                                      |  ETA: 0:04:00
Simulating  25%|█████████▉                              |  ETA: 0:00:34
Simulating  47%|██████████████████▉                     |  ETA: 0:00:13
Simulating  64%|█████████████████████████▋              |  ETA: 0:00:06
Simulating  85%|█████████████████████████████████▉      |  ETA: 0:00:02
[ Info: Computation time: 11 seconds, 353 milliseconds
[ Info: The model finished successfully at 2026-02-02T10:59:22.418.</code></pre>
</div>
</div>
<p>Analyze the results - first look at basin levels:</p>
<div id="92653001" class="cell" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df_basin <span class="op">=</span> pd.read_feather(datadir <span class="op">/</span> <span class="st">"polder_management/results/basin.arrow"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>df_basin_wide <span class="op">=</span> df_basin.pivot_table(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">"time"</span>, columns<span class="op">=</span><span class="st">"node_id"</span>, values<span class="op">=</span>[<span class="st">"storage"</span>, <span class="st">"level"</span>]</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df_basin_wide[<span class="st">"level"</span>].plot()</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="fl">1.0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="st">"Polder 4 target"</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="fl">0.9</span>, color<span class="op">=</span><span class="st">"orange"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="st">"Polder 6 target"</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"level [m]"</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-58-output-1.png" width="597" height="444" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The plot shows how allocation maintains the polder target levels (1.0 m for basin 4, 0.9 m for basin 6) despite varying precipitation and evaporation.</p>
<p>Examine the flow rates managed by allocation:</p>
<div id="55906750" class="cell" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df_flow <span class="op">=</span> pd.read_feather(datadir <span class="op">/</span> <span class="st">"polder_management/results/flow.arrow"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>df_flow[<span class="st">"link"</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(df_flow.from_node_id, df_flow.to_node_id))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>df_flow[<span class="st">"flow_m3d"</span>] <span class="op">=</span> df_flow.flow_rate</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on allocation-controlled structures</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>controlled_links <span class="op">=</span> [(<span class="dv">3</span>, <span class="dv">5</span>), (<span class="dv">4</span>, <span class="dv">13</span>), (<span class="dv">6</span>, <span class="dv">7</span>)]  <span class="co"># inlet, polder connection, pump</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>df_controlled <span class="op">=</span> df_flow[df_flow[<span class="st">"link"</span>].isin(controlled_links)]</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>df_pivot <span class="op">=</span> df_controlled.pivot_table(index<span class="op">=</span><span class="st">"time"</span>, columns<span class="op">=</span><span class="st">"link"</span>, values<span class="op">=</span><span class="st">"flow_m3d"</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df_pivot.plot()</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"flow [m³/s]"</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">"Link (from → to)"</span>, labels<span class="op">=</span>[<span class="st">"Boezem→Polder4"</span>, <span class="st">"Polder4→Polder6"</span>, <span class="st">"Polder6→Boezem"</span>])</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-59-output-1.png" width="589" height="444" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The allocation algorithm automatically:</p>
<ul>
<li>Supplies water during dry periods (positive flow through inlet)</li>
<li>Removes excess water during wet periods (positive flow through pump)</li>
<li>Transfers water between polders as needed</li>
<li>Respects maximum flow rate constraints</li>
<li>Prioritizes demands by priority level</li>
</ul>
</section>
<section id="model-with-continuous-control" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Model with continuous control</h1>
<div id="5089807f" class="cell" data-execution_count="59">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(starttime<span class="op">=</span><span class="st">"2020-01-01"</span>, endtime<span class="op">=</span><span class="st">"2021-01-01"</span>, crs<span class="op">=</span><span class="st">"EPSG:28992"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Set up the transient level boundary:</p>
<div id="843a7671" class="cell" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>model.level_boundary.add(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">1</span>, Point(<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>        level_boundary.Time(</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>            time<span class="op">=</span>pd.date_range(</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                start<span class="op">=</span><span class="st">"2020-01-01"</span>, end<span class="op">=</span><span class="st">"2021-01-01"</span>, periods<span class="op">=</span><span class="dv">100</span>, unit<span class="op">=</span><span class="st">"ms"</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span><span class="fl">6.0</span> <span class="op">+</span> np.sin(np.linspace(<span class="dv">0</span>, <span class="dv">6</span> <span class="op">*</span> np.pi, <span class="dv">100</span>)),</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>LevelBoundary #1</code></pre>
</div>
</div>
<p>Set up the linear resistance:</p>
<div id="b95306a6" class="cell" data-execution_count="61">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>model.linear_resistance.add(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">2</span>, Point(<span class="dv">1</span>, <span class="dv">0</span>)), [linear_resistance.Static(resistance<span class="op">=</span>[<span class="fl">10.0</span>])]</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>LinearResistance #2</code></pre>
</div>
</div>
<p>Set up the basin:</p>
<div id="52f77c90" class="cell" data-execution_count="62">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>model.basin.add(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">3</span>, Point(<span class="dv">2</span>, <span class="dv">0</span>)),</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        basin.Profile(area<span class="op">=</span><span class="fl">10000.0</span>, level<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>]),</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        basin.State(level<span class="op">=</span>[<span class="fl">10.0</span>]),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>Basin #3</code></pre>
</div>
</div>
<p>Set up the outlets:</p>
<div id="eea2f819" class="cell" data-execution_count="63">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>model.outlet.add(Node(<span class="dv">4</span>, Point(<span class="dv">3</span>, <span class="dv">1</span>)), [outlet.Static(flow_rate<span class="op">=</span>[<span class="fl">1.0</span>])])</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>model.outlet.add(Node(<span class="dv">5</span>, Point(<span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>)), [outlet.Static(flow_rate<span class="op">=</span>[<span class="fl">1.0</span>])])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>Outlet #5</code></pre>
</div>
</div>
<p>Set up the terminals:</p>
<div id="f9d4a922" class="cell" data-execution_count="64">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>model.terminal.add(Node(<span class="dv">6</span>, Point(<span class="dv">4</span>, <span class="dv">1</span>)))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>model.terminal.add(Node(<span class="dv">7</span>, Point(<span class="dv">4</span>, <span class="op">-</span><span class="dv">1</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>Terminal #7</code></pre>
</div>
</div>
<p>Set up the continuous control:</p>
<div id="e54ef6d8" class="cell" data-execution_count="65">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>model.continuous_control.add(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">8</span>, Point(<span class="dv">2</span>, <span class="dv">1</span>)),</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>        continuous_control.Variable(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>            listen_node_id<span class="op">=</span>[<span class="dv">2</span>],</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>            variable<span class="op">=</span><span class="st">"flow_rate"</span>,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>        continuous_control.Function(</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>            <span class="bu">input</span><span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>],</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>            output<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.6</span>],</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>            controlled_variable<span class="op">=</span><span class="st">"flow_rate"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>model.continuous_control.add(</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    Node(<span class="dv">9</span>, Point(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>)),</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>        continuous_control.Variable(</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>            listen_node_id<span class="op">=</span>[<span class="dv">2</span>],</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>            variable<span class="op">=</span><span class="st">"flow_rate"</span>,</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>        continuous_control.Function(</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">input</span><span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">1.0</span>],</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>            output<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.4</span>],</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>            controlled_variable<span class="op">=</span><span class="st">"flow_rate"</span>,</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>ContinuousControl #9</code></pre>
</div>
</div>
<p>This defines:</p>
<ul>
<li>A <code>ContinuousControl</code> node with ID 1, which listens to the flow rate of the <code>LinearResistance</code> node with ID 1, puts that through the function <span class="math inline">\(f(x) = \max(0, 0.6x)\)</span>, and assigns the result to the flow rate of the node this <code>ContinuousControl</code> node is controlling, which is defined by a (control) link;</li>
<li>A <code>ContinuousControl</code> node with ID 2, which listens to the flow rate of the <code>LinearResistance</code> node with ID 1, puts that through the function <span class="math inline">\(f(x) = \max(0, 0.4x)\)</span>, and assigns the result to the flow rate of the node this <code>ContinuousControl</code> node is controlling, which is defined by a (control) link.</li>
</ul>
<div id="044ebccf" class="cell" data-execution_count="66">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>model.link.add(model.level_boundary[<span class="dv">1</span>], model.linear_resistance[<span class="dv">2</span>])</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>model.link.add(model.linear_resistance[<span class="dv">2</span>], model.basin[<span class="dv">3</span>])</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>model.link.add(model.basin[<span class="dv">3</span>], model.outlet[<span class="dv">4</span>])</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>model.link.add(model.basin[<span class="dv">3</span>], model.outlet[<span class="dv">5</span>])</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>model.link.add(model.outlet[<span class="dv">4</span>], model.terminal[<span class="dv">6</span>])</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>model.link.add(model.outlet[<span class="dv">5</span>], model.terminal[<span class="dv">7</span>])</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define which node is controlled by each continuous control node</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>model.link.add(model.continuous_control[<span class="dv">8</span>], model.outlet[<span class="dv">4</span>])</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>model.link.add(model.continuous_control[<span class="dv">9</span>], model.outlet[<span class="dv">5</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s take a look at the model:</p>
<div id="3d13e52b" class="cell" data-execution_count="67">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>model.plot()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-68-output-1.png" width="718" height="337" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>With this setup we want to split the flow coming into the basin into a 60% - 40% ratio.</p>
<p>Write the model to a TOML and GeoPackage:</p>
<div id="5aff2595" class="cell" data-execution_count="68">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>toml_path <span class="op">=</span> datadir <span class="op">/</span> <span class="st">"outlet_continuous_control/ribasim.toml"</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>model.write(toml_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>PosixPath('data/outlet_continuous_control/ribasim.toml')</code></pre>
</div>
</div>
<p>Now run the model.</p>
<div id="6f6d57dc" class="cell" data-execution_count="69">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>run_ribasim(toml_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Starting a Ribasim simulation at 2026-02-02T10:59:23.678.
│   toml_path = "data/outlet_continuous_control/ribasim.toml"
│   ribasim_version = "2026.1.0-rc1"
│   starttime = 2020-01-01T00:00:00
│   endtime = 2021-01-01T00:00:00
└   threads = 1
Simulating   0%|                                        |  ETA: N/A
Simulating   1%|▌                                       |  ETA: 0:00:01
Simulating   9%|███▊                                    |  ETA: 0:00:00
Simulating  18%|███████▏                                |  ETA: 0:00:00
Simulating  25%|██████████▏                             |  ETA: 0:00:00
Simulating  35%|█████████████▉                          |  ETA: 0:00:00
Simulating  45%|██████████████████▏                     |  ETA: 0:00:00
Simulating  56%|██████████████████████▎                 |  ETA: 0:00:00
Simulating  65%|█████████████████████████▉              |  ETA: 0:00:00
Simulating  76%|██████████████████████████████▎         |  ETA: 0:00:00
Simulating  87%|██████████████████████████████████▋     |  ETA: 0:00:00
Simulating  96%|██████████████████████████████████████▌ |  ETA: 0:00:00
Simulating 100%|████████████████████████████████████████| Time: 0:00:00
[ Info: Computation time: 165 milliseconds
[ Info: The model finished successfully at 2026-02-02T10:59:27.316.</code></pre>
</div>
</div>
<p>After running the model, read back the results:</p>
<div id="914676f3" class="cell" data-execution_count="70">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df_flow <span class="op">=</span> pd.read_feather(datadir <span class="op">/</span> <span class="st">"outlet_continuous_control/results/flow.arrow"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_link_flow(from_node_type, from_node_id, to_node_type, to_node_id):</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    df_flow_filtered <span class="op">=</span> df_flow[</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>        (df_flow[<span class="st">"from_node_id"</span>] <span class="op">==</span> from_node_id)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (df_flow[<span class="st">"to_node_id"</span>] <span class="op">==</span> to_node_id)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    df_flow_filtered.plot(</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"time"</span>,</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"flow_rate"</span>,</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>from_node_type<span class="sc">}</span><span class="ss"> #</span><span class="sc">{</span>from_node_id<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>to_node_type<span class="sc">}</span><span class="ss"> #</span><span class="sc">{</span>to_node_id<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>plot_link_flow(<span class="st">"LinearResistance"</span>, <span class="dv">1</span>, <span class="st">"Basin"</span>, <span class="dv">1</span>)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>plot_link_flow(<span class="st">"Basin"</span>, <span class="dv">1</span>, <span class="st">"Outlet"</span>, <span class="dv">1</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>plot_link_flow(<span class="st">"Basin"</span>, <span class="dv">1</span>, <span class="st">"Outlet"</span>, <span class="dv">2</span>)</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"flow [m³s⁻¹]"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="examples_files/figure-html/cell-71-output-1.png" width="600" height="412" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../getting-started/tutorial/reservoir.html" class="pagination-link" aria-label="Reservoir">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Reservoir</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>