<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Usage – Ribasim</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../reference/validation.html" rel="next">
<link href="../reference/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0b1189524dc19e09ab363e9b4d3e2f65.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../assets/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="https://user-images.githubusercontent.com/4471859/224825908-bee7e044-bc6b-4561-8b08-5d330cce3ed5.png" alt="" class="navbar-logo light-content">
    <img src="https://user-images.githubusercontent.com/4471859/224825908-bee7e044-bc6b-4561-8b08-5d330cce3ed5.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Ribasim</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../getting-started/install.html"> 
<span class="menu-text">Getting started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../guide/qgis.html"> 
<span class="menu-text">How-to guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../concept/concept.html"> 
<span class="menu-text">Concepts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../reference/index.html" aria-current="page"> 
<span class="menu-text">Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../dev/index.html"> 
<span class="menu-text">Contributing</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Deltares/Ribasim"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../reference/usage.html">Usage</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/usage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Usage</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/python/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python API</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/test-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Test models</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Nodes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/basin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basin</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/tabulated-rating-curve.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TabulatedRatingCurve</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/pump.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pump</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/outlet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Outlet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/user-demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UserDemand</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/flow-demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FlowDemand</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/level-demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LevelDemand</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/flow-boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FlowBoundary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/level-boundary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LevelBoundary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/linear-resistance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LinearResistance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/manning-resistance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ManningResistance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/terminal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Terminal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/junction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Junction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/discrete-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DiscreteControl</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/continuous-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ContinuousControl</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/node/pid-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PidControl</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#configuration-file" id="toc-configuration-file" class="nav-link active" data-scroll-target="#configuration-file"><span class="header-section-number">1</span> Configuration file</a>
  <ul class="collapse">
  <li><a href="#sec-solver-settings" id="toc-sec-solver-settings" class="nav-link" data-scroll-target="#sec-solver-settings"><span class="header-section-number">1.1</span> Solver settings</a></li>
  <li><a href="#interpolation-settings" id="toc-interpolation-settings" class="nav-link" data-scroll-target="#interpolation-settings"><span class="header-section-number">1.2</span> Interpolation settings</a></li>
  <li><a href="#sec-allocation-settings" id="toc-sec-allocation-settings" class="nav-link" data-scroll-target="#sec-allocation-settings"><span class="header-section-number">1.3</span> Allocation settings</a></li>
  <li><a href="#results-settings" id="toc-results-settings" class="nav-link" data-scroll-target="#results-settings"><span class="header-section-number">1.4</span> Results settings</a></li>
  <li><a href="#logging-settings" id="toc-logging-settings" class="nav-link" data-scroll-target="#logging-settings"><span class="header-section-number">1.5</span> Logging settings</a></li>
  <li><a href="#experimental-features" id="toc-experimental-features" class="nav-link" data-scroll-target="#experimental-features"><span class="header-section-number">1.6</span> Experimental features</a></li>
  </ul></li>
  <li><a href="#sec-geopackage" id="toc-sec-geopackage" class="nav-link" data-scroll-target="#sec-geopackage"><span class="header-section-number">2</span> GeoPackage database and Arrow tables</a>
  <ul class="collapse">
  <li><a href="#table-requirements" id="toc-table-requirements" class="nav-link" data-scroll-target="#table-requirements"><span class="header-section-number">2.1</span> Table requirements</a></li>
  <li><a href="#custom-metadata" id="toc-custom-metadata" class="nav-link" data-scroll-target="#custom-metadata"><span class="header-section-number">2.2</span> Custom metadata</a></li>
  </ul></li>
  <li><a href="#sec-node" id="toc-sec-node" class="nav-link" data-scroll-target="#sec-node"><span class="header-section-number">3</span> Node</a>
  <ul class="collapse">
  <li><a href="#cyclic-time-series" id="toc-cyclic-time-series" class="nav-link" data-scroll-target="#cyclic-time-series"><span class="header-section-number">3.1</span> Cyclic time series</a></li>
  <li><a href="#subnetwork-id" id="toc-subnetwork-id" class="nav-link" data-scroll-target="#subnetwork-id"><span class="header-section-number">3.2</span> Subnetwork ID</a></li>
  </ul></li>
  <li><a href="#sec-link" id="toc-sec-link" class="nav-link" data-scroll-target="#sec-link"><span class="header-section-number">4</span> Link</a></li>
  <li><a href="#sec-results" id="toc-sec-results" class="nav-link" data-scroll-target="#sec-results"><span class="header-section-number">5</span> Results</a>
  <ul class="collapse">
  <li><a href="#basin---basin" id="toc-basin---basin" class="nav-link" data-scroll-target="#basin---basin"><span class="header-section-number">5.1</span> Basin - <code>basin</code></a></li>
  <li><a href="#flow---flow" id="toc-flow---flow" class="nav-link" data-scroll-target="#flow---flow"><span class="header-section-number">5.2</span> Flow - <code>flow</code></a></li>
  <li><a href="#sec-state" id="toc-sec-state" class="nav-link" data-scroll-target="#sec-state"><span class="header-section-number">5.3</span> State - <code>basin_state</code></a></li>
  <li><a href="#discretecontrol---control" id="toc-discretecontrol---control" class="nav-link" data-scroll-target="#discretecontrol---control"><span class="header-section-number">5.4</span> DiscreteControl - <code>control</code></a></li>
  <li><a href="#allocation---allocation" id="toc-allocation---allocation" class="nav-link" data-scroll-target="#allocation---allocation"><span class="header-section-number">5.5</span> Allocation - <code>allocation</code></a></li>
  <li><a href="#allocation-flow---allocation_flow" id="toc-allocation-flow---allocation_flow" class="nav-link" data-scroll-target="#allocation-flow---allocation_flow"><span class="header-section-number">5.6</span> Allocation flow - <code>allocation_flow</code></a></li>
  <li><a href="#allocation-feasibility-analysis---allocation_analysis_feasibility.log" id="toc-allocation-feasibility-analysis---allocation_analysis_feasibility.log" class="nav-link" data-scroll-target="#allocation-feasibility-analysis---allocation_analysis_feasibility.log"><span class="header-section-number">5.7</span> Allocation feasibility analysis - <code>allocation_analysis_feasibility.log</code></a></li>
  <li><a href="#allocation-scaling-analysis---allocation_analysis_scaling.log" id="toc-allocation-scaling-analysis---allocation_analysis_scaling.log" class="nav-link" data-scroll-target="#allocation-scaling-analysis---allocation_analysis_scaling.log"><span class="header-section-number">5.8</span> Allocation scaling analysis - <code>allocation_analysis_scaling.log</code></a></li>
  <li><a href="#concentration---concentration" id="toc-concentration---concentration" class="nav-link" data-scroll-target="#concentration---concentration"><span class="header-section-number">5.9</span> Concentration - <code>concentration</code></a></li>
  <li><a href="#subgrid-level---subgrid_level" id="toc-subgrid-level---subgrid_level" class="nav-link" data-scroll-target="#subgrid-level---subgrid_level"><span class="header-section-number">5.10</span> Subgrid level - <code>subgrid_level</code></a></li>
  <li><a href="#solver-statistics---solver_stats" id="toc-solver-statistics---solver_stats" class="nav-link" data-scroll-target="#solver-statistics---solver_stats"><span class="header-section-number">5.11</span> Solver statistics - <code>solver_stats</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Usage</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="configuration-file" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Configuration file</h1>
<p>Ribasim has a single configuration file, which is written in the <a href="https://toml.io/">TOML</a> format. It contains settings, as well as paths to other input and output files. Ribasim expects the GeoPackage database <a href="../reference/usage.html#sec-geopackage">database.gpkg</a> as well as optional Arrow input files to be available in the input_dir.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start- and endtime of the simulation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can also be set to a date-time like 1979-05-27T07:32:00</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">starttime</span> <span class="op">=</span> <span class="bn">2019-01-01</span> <span class="co"># required</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">endtime</span> <span class="op">=</span> <span class="bn">2021-01-01</span>   <span class="co"># required</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinate Reference System</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The accepted strings are documented here:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://proj.org/en/9.4/development/reference/functions.html#c.proj_create</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">crs</span> <span class="op">=</span> <span class="st">"EPSG:4326"</span>      <span class="co"># required</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># input and results directories relative to the TOML file</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">input_dir</span> <span class="op">=</span> <span class="st">"input"</span>     <span class="co"># required</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dt">results_dir</span> <span class="op">=</span> <span class="st">"results"</span> <span class="co"># required</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dt">ribasim_version</span> <span class="op">=</span> <span class="st">"2025.6.0"</span> <span class="co"># required</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Specific tables can also go into Arrow files rather than the database.</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For large tables this can benefit from better compressed file sizes.</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># This is optional, tables are retrieved from the database if not specified in the TOML.</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">[basin]</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="dt">time</span> <span class="op">=</span> <span class="st">"basin/time.arrow"</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="kw">[interpolation]</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="dt">flow_boundary</span> <span class="op">=</span> <span class="st">"block"</span>   <span class="co"># optional, default "block", can otherwise be "linear"</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="dt">block_transition_period</span> <span class="op">=</span> <span class="dv">0</span>  <span class="co"># optional, default 0</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="kw">[allocation]</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="dt">timestep</span> <span class="op">=</span> <span class="dv">86400</span>         <span class="co"># optional (required if experimental.allocation = true), default 86400</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="kw">[allocation.route_priority]</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="dt">level_boundary</span> <span class="op">=</span> <span class="dv">1000</span>       <span class="co"># optional, default 1000</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="dt">basin</span> <span class="op">=</span> <span class="dv">2000</span>                <span class="co"># optional, default 2000</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="dt">manning_resistance</span> <span class="op">=</span> <span class="dv">10</span>     <span class="co"># optional, default 10</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="dt">linear_resistance</span> <span class="op">=</span> <span class="dv">20</span>      <span class="co"># optional, default 20</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="dt">tabulated_rating_curve</span> <span class="op">=</span> <span class="dv">30</span> <span class="co"># optional, default 30</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="dt">outlet</span> <span class="op">=</span> <span class="dv">30</span>                 <span class="co"># optional, default 40</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="dt">pump</span> <span class="op">=</span> <span class="dv">40</span>                   <span class="co"># optional, default 50</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="kw">[solver]</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="dt">algorithm</span> <span class="op">=</span> <span class="st">"QNDF"</span>  <span class="co"># optional, default "QNDF"</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="dt">saveat</span> <span class="op">=</span> <span class="dv">86400</span>      <span class="co"># optional, default 86400, 0 saves every timestep, inf saves only at start- and endtime</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="dt">dt</span> <span class="op">=</span> <span class="fl">60.0</span>           <span class="co"># optional, remove for adaptive time stepping</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="dt">dtmin</span> <span class="op">=</span> <span class="fl">0.0</span>         <span class="co"># optional, default 0.0</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="dt">dtmax</span> <span class="op">=</span> <span class="fl">0.0</span>         <span class="co"># optional, default length of simulation</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="dt">force_dtmin</span> <span class="op">=</span> <span class="cn">false</span> <span class="co"># optional, default false</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="dt">abstol</span> <span class="op">=</span> <span class="fl">1e-5</span>       <span class="co"># optional, default 1e-5</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="dt">reltol</span> <span class="op">=</span> <span class="fl">1e-5</span>       <span class="co"># optional, default 1e-5</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="dt">water_balance_abstol</span> <span class="op">=</span> <span class="fl">1e-3</span> <span class="co"># optional, default 1e-3</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="dt">water_balance_reltol</span> <span class="op">=</span> <span class="fl">1e-2</span> <span class="co"># optional, default 1e-2</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="dt">maxiters</span> <span class="op">=</span> <span class="fl">1e9</span>      <span class="co"># optional, default 1e9</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="dt">sparse</span> <span class="op">=</span> <span class="cn">true</span>       <span class="co"># optional, default true</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="dt">autodiff</span> <span class="op">=</span> <span class="cn">true</span>     <span class="co"># optional, default true</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="dt">evaporate_mass</span> <span class="op">=</span> <span class="cn">true</span>  <span class="co"># optional, default true to simulate a correct mass balance</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="dt">depth_threshold</span> <span class="op">=</span> <span class="fl">0.1</span>  <span class="co"># optional, default 0.1</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="dt">level_difference_threshold</span> <span class="op">=</span> <span class="fl">0.02</span> <span class="co"># optional, default 0.02</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="dt">specialize</span> <span class="op">=</span> <span class="cn">false</span>  <span class="co"># optional, default false</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="kw">[logging]</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># defines the logging level of Ribasim</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="dt">verbosity</span> <span class="op">=</span> <span class="st">"info"</span> <span class="co"># optional, default "info", can also be "debug", "warn" or "error"</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="kw">[results]</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="dt">format</span> <span class="op">=</span> <span class="st">"arrow"</span>      <span class="co"># optional, default "arrow", can also be "netcdf"</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="dt">compression</span> <span class="op">=</span> <span class="cn">true</span>    <span class="co"># optional, default true, using zstd compression</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="dt">compression_level</span> <span class="op">=</span> <span class="dv">6</span> <span class="co"># optional, default 6</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="dt">subgrid</span> <span class="op">=</span> <span class="cn">false</span>       <span class="co"># optional, default false</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="kw">[experimental]</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimental features, disabled by default</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="dt">concentration</span> <span class="op">=</span> <span class="cn">false</span> <span class="co"># tracer calculations</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="dt">allocation</span> <span class="op">=</span> <span class="cn">false</span> <span class="co"># allocation layer, replaced by 'first come first serve' when inactive</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="sec-solver-settings" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-solver-settings"><span class="header-section-number">1.1</span> Solver settings</h2>
<p>The solver section in the configuration file is entirely optional, since we aim to use defaults that will generally work well. Common reasons to modify the solver settings are to adjust the calculation or result stepsizes: <code>dt</code>, and <code>saveat</code>. If your model does not converge, or your performance is lower than expected, it can help to adjust other solver settings as well.</p>
<p>The default solver <code>algorithm = "QNDF"</code>, which is a multistep method similar to Matlab’s <code>ode15s</code> <span class="citation" data-cites="shampine1997matlab">(<a href="#ref-shampine1997matlab" role="doc-biblioref">Shampine and Reichelt 1997</a>)</span>. It is an implicit method that supports the default adaptive timestepping. The full list of available solvers is: <code>QNDF</code>, <code>FBDF</code>, <code>Rosenbrock23</code>, <code>Rodas4P</code>, <code>Rodas5P</code>, <code>TRBDF2</code>, <code>KenCarp4</code>, <code>Tsit5</code>, <code>RK4</code>, <code>ImplicitEuler</code>, <code>Euler</code>. Information on the solver algorithms can be found on the <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/ode_solve/">ODE solvers page</a>.</p>
<p>By default Ribasim uses adaptive timestepping, though not all algorithms support adaptive timestepping. To use fixed timesteps, provide a timestep size in seconds; <code>dt = 3600.0</code> corresponds to an hourly timestep. With adaptive timestepping, <code>dtmin</code> and <code>dtmax</code> control the minimum and maximum allowed <code>dt</code>. If a smaller <code>dt</code> than <code>dtmin</code> is needed to meet the set error tolerances, the simulation stops, unless <code>force_dtmin</code> is set to <code>true</code>. <code>force_dtmin</code> is off by default to ensure an accurate solution.</p>
<p>The <code>saveat</code> setting controls the output frequency. It is the number of seconds between timestamps in the results. The default result stepsize, <code>saveat = 86400</code> will save results daily. The calculation and result stepsize need not be the same. If you wish to save every calculation step, set <code>saveat = 0</code>. With the default adaptive timestepping that will result in irregular time series. If you wish to not save any intermediate steps, set <code>saveat = inf</code>. For output frequencies that are not of fixed length, like months or years, we suggest to resample from daily results during post-processing.</p>
<p>The water balance error is a measure of the error in the consistency with which the core keeps track of the water resources per Basin, for more details see <a href="../concept/equations.html#the-water-balance-error">here</a>. <code>water_balance_abstol</code> and <code>water_balance_reltol</code> give upper bounds on this error, above which an error is thrown. A too large error generally indicates an error in the code or floating point truncation errors.</p>
<p>The Jacobian matrix provides information about the local sensitivity of the model with respect to changes in the states. For implicit solvers it must be calculated often, which can be expensive to do. There are several methods to do this. By default Ribasim uses a Jacobian derived automatically using <a href="https://juliadiff.org/ForwardDiff.jl/stable/">ForwardDiff.jl</a> with memory management provided by <a href="https://docs.sciml.ai/PreallocationTools/stable/">PreallocationTools.jl</a>. If this is not used by setting <code>autodiff = false</code>, the Jacobian is calculated with a finite difference method, which can be less accurate and more expensive.</p>
<p>By default the Jacobian matrix is a sparse matrix (<code>sparse = true</code>). Since each state typically only depends on a small number of other states, this is generally more efficient, especially for larger models. The sparsity structure is calculated from the network and provided as a Jacobian prototype to the solver. For small or highly connected models it could be faster to use a dense Jacobian matrix instead by setting <code>sparse = false</code>.</p>
<p>The total maximum number of iterations <code>maxiters = 1e9</code>, can normally stay as-is unless doing extremely long simulations.</p>
<p>The absolute and relative tolerance for adaptive timestepping can be set with <code>abstol</code> and <code>reltol</code>. For more information on these and other solver options, see the <a href="https://docs.sciml.ai/DiffEqDocs/latest/basics/common_solver_opts/#solver_options">DifferentialEquations.jl docs</a> and the <a href="https://docs.sciml.ai/DiffEqDocs/stable/basics/faq/#What-does-tolerance-mean-and-how-much-error-should-I-expect">DifferentialEquations.jl FAQ</a>.</p>
<p>The <code>evaporate_mass = true</code> setting determines whether mass is lost due to evaporation in water quality calculations, by default set to true. While physically incorrect, it is useful for a first correctness check on a model in terms of mass balance (Continuity tracer should always have a concentration of 1). To simulate increasing concentrations (e.g.&nbsp;salinity) due to evaporation, change the setting to <code>false</code>.</p>
<p>By default <code>specialize = false</code> to reduce the time it takes to initialize fully. It can be enabled for long-running simulations, trading initialization speed for simulation speed. Concretely, setting it will set the <a href="https://docs.sciml.ai/SciMLBase/stable/interfaces/Problems/#Specialization-Levels">specialization level</a> to NoSpecialize for false, and FullSpecialize for true. Additionally setting it to false also fixes the <a href="https://juliadiff.org/ForwardDiff.jl/stable/user/advanced/#Configuring-Chunk-Size">autodiff chunk size</a> to 1, making a similar tradeoff as the specialization level.</p>
<p>There are two threshold parameters that control when reduction factors start smoothly reducing flow. Note that these are global settings, and cannot be set for individual nodes. <code>depth_threshold = 0.1</code> is the water depth (level - profile bottom) in meters at which the low storage factor kicks in. This will limit any extraction from nearly empty Basins, and avoids drying them out completely. <code>level_difference_threshold = 0.02</code> is the level difference below which several flows are reduced. Examples are approaching <code>min_upstream_level</code> from above and <code>max_downstream_level</code> from below, level difference across TabulatedRatingCurve and Outlet nodes, and UserDemand approaching the <code>min_level</code> from above. For details see the equations on the node reference pages, and the section on <a href="../reference/node/basin.html#sec-reduction-factor">reduction factors</a></p>
</section>
<section id="interpolation-settings" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="interpolation-settings"><span class="header-section-number">1.2</span> Interpolation settings</h2>
<p>There are the following interpolation settings:</p>
<ul>
<li><code>flow_boundary</code>: The interpolation type of flow boundary timeseries. This is <code>linear</code> by default, but can also be set to <code>block</code>.</li>
<li><code>block_transition_period</code>: When an interpolation type is set to <code>block</code>, this parameter determines an interval in time on either side of each data point which is used to smooth the transition between data points. See also the <a href="https://docs.sciml.ai/DataInterpolations/dev/methods/#Smoothed-Constant-Interpolation">documentation</a> for this interpolation type.</li>
</ul>
</section>
<section id="sec-allocation-settings" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="sec-allocation-settings"><span class="header-section-number">1.3</span> Allocation settings</h2>
<p>There are the following allocation settings:</p>
<ul>
<li><code>timestep</code>: A float value in seconds which dictates the update interval for allocations;</li>
<li><code>route_priority</code>: An integer per source type for the allocation algorithm. The prioritisable sources are: <code>basin</code>, <code>level_boundary</code>, <code>linear_resistance</code>, <code>manning_resistance</code>, <code>outlet</code> and <code>pump</code>.
<ul>
<li>If you wish to set the route priority for specific nodes rather than a fallback per node type, these can be set in the <a href="#sec-node">Node table</a>.</li>
<li>By default, all nodes of the same type have the same route priority. To obtain a strict source ordering, the sources are sorted by node ID for each route priority within a subnetwork.</li>
<li>When no default route priorities are specified, default values are applied (see the TOML example above).</li>
</ul>
The way the route priorities work is as follows: The priority that is assigned to a node is interpreted as the cost it takes for water to flow through that node. The flow through each node is multiplied with the priority, and we find the water distribution solution that has the lowest cost of fulfilling the desired demands.</li>
</ul>
</section>
<section id="results-settings" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="results-settings"><span class="header-section-number">1.4</span> Results settings</h2>
<p>The following entries can be set in the configuration in the <code>[results]</code> section.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 17%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>entry</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>format</td>
<td>String</td>
<td>File format, default is “arrow” for Apache Arrow, other option is “netcdf” for NetCDF with CF conventions.</td>
</tr>
<tr class="even">
<td>compression</td>
<td>Bool</td>
<td>Whether to apply compression or not.</td>
</tr>
<tr class="odd">
<td>compression_level</td>
<td>Int</td>
<td>Zstandard compression level. Default is 6, higher compresses more.</td>
</tr>
<tr class="even">
<td>subgrid</td>
<td>Bool</td>
<td>Compute and output more detailed water levels.</td>
</tr>
</tbody>
</table>
<p>Currently compression is only used for Apache Arrow. NetCDF will be the only output format later on.</p>
</section>
<section id="logging-settings" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="logging-settings"><span class="header-section-number">1.5</span> Logging settings</h2>
<p>The following can be set in the configuration in the <code>[logging]</code> section.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 17%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>entry</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>verbosity</td>
<td>String</td>
<td>Verbosity level: debug, info, warn, or error.</td>
</tr>
</tbody>
</table>
<p>If verbosity is set to debug, the used <code>Basin / profile</code> dimensions (level, area and storage) are written to a CSV file in the results folder. This can be useful if you only provide 2 of the 3 columns and want to inspect the dimensions used in the computation.</p>
<p>The format of the CSV is: column 1 = node id, column 2 = level, column 3 = area and row 4 is storage.</p>
<p>Lets say you have 2 basins at node 1 and node 2. Dimensions node 1: level = [0, 1, 2], area = [2, 2, 4] and storage = [0, 2, 6], Dimensions node 1: level = [0, 1, 2], area = [4, 4, 8] and storage = [0, 4, 12].</p>
<p>Then the CSV will look like:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>node_id</th>
<th>level</th>
<th>area</th>
<th>storage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>4</td>
<td>6</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>4</td>
<td>0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>8</td>
<td>12</td>
</tr>
</tbody>
</table>
</section>
<section id="experimental-features" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="experimental-features"><span class="header-section-number">1.6</span> Experimental features</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Experimental features are completely unsupported. They can break at any time and results will be wrong. <strong>Do not use them in production</strong>. If you’re interested in using an experimental feature, please <a href="../contact.html">contact us</a>.</p>
</div>
</div>
<p>One can enable experimental features in the <code>[experimental]</code> section. Currently the following features can be enabled (all are disabled by default).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 17%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>entry</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>concentration</td>
<td>Bool</td>
<td>Whether to enable tracer calculations or not.</td>
</tr>
<tr class="even">
<td>allocation</td>
<td>Bool</td>
<td>Whether to activate the activation layer. Replaced by ‘first come first serve’ when deactivated</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="sec-geopackage" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> GeoPackage database and Arrow tables</h1>
<p>The input and output tables described below all share that they are tabular files. The Node and Link tables always have to be in the <a href="https://www.geopackage.org/">GeoPackage</a> database file, and results are always written to <a href="https://arrow.apache.org/">Apache Arrow</a> files, sometimes also known as Feather files. All other tables can either be in the database or in separate Arrow files that are listed in the TOML as described above.</p>
<p>For visualization, the Node and Link tables typically have associated geometries. GeoPackage was used since it provides a standardized way to store tables with (and without) geometry columns in a SQLite database. If, like Ribasim, you can ignore the geometries, a GeoPackage is easy to read using SQLite libraries, which are commonly available. Furthermore GeoPackage can be updated in place when working on a model.</p>
<p>Arrow was chosen since it is standardized, fast, simple and flexible. It can be read and written by many different software packages. In Ribasim we use <a href="https://arrow.apache.org/julia/dev/">Arrow.jl</a>. Results can be written to Arrow, since for long runs Ribasim can produce tables with many rows. Arrow is well suited for large tabular datasets, and file size is kept small by using compression. The Arrow input files can be compressed with LZ4 or Zstd compression. Furthermore, in some of the columns, a small amount of different values are repeated many times. To reduce file sizes it may be a good idea to apply <a href="https://arrow.apache.org/docs/format/Columnar.html#dictionary-encoded-layout">dictionary encoding</a> to those columns. The Ribasim version that was used to create the results is written to each file in the <code>ribasim_version</code> schema metadata.</p>
<section id="table-requirements" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="table-requirements"><span class="header-section-number">2.1</span> Table requirements</h2>
<p>Below we give details per file, in which we describe the schema of the table using a syntax like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int32</td>
<td>-</td>
<td>sorted</td>
</tr>
<tr class="even">
<td>storage</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3\)</span></td>
<td>non-negative</td>
</tr>
</tbody>
</table>
<p>This means that two columns are required, one named <code>node_id</code>, that contained elements of type <code>Int32</code>, and a column named <code>storage</code> that contains elements of type <code>Float64</code>. The order of the columns does not matter. In some cases there may be restrictions on the values. This is indicated under <code>restriction</code>.</p>
<p>Tables are also allowed to have rows for timestamps that are not part of the simulation, these will be ignored. That makes it easy to prepare data for a larger period, and test models on a shorted period.</p>
<p>When preparing the model for simulation, input validation is performed in the Julia core. The validation rules are described in the <a href="../reference/validation.html">validation</a> section.</p>
</section>
<section id="custom-metadata" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="custom-metadata"><span class="header-section-number">2.2</span> Custom metadata</h2>
<p>It may be advantageous to add metadata to rows. For example, basin areas might have names and objects such as weirs might have specific identification codes. Additional columns can be freely added to tables. The column names should be prefixed with <code>meta_</code>. They will not be used in computations or validated by the Julia core.</p>
</section>
</section>
<section id="sec-node" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Node</h1>
<p>Node is a table that specifies the ID and type of each node of a model. The ID must be unique among all nodes, and the type must be one of the available node types listed below.</p>
<p>Nodes are components that are connected together to form a larger system. The Basin is a central node type that stores water. The other node types influence the flow between Basins in some way. Counter intuitively, even systems you may think of as links, such as a canal, are nodes in Ribasim. This is because links only define direct instantaneous couplings between nodes, and never have storage of their own.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_type</td>
<td>String</td>
<td>sorted, known node type</td>
</tr>
<tr class="even">
<td>node_id</td>
<td>Int32</td>
<td>sorted per node_type</td>
</tr>
<tr class="odd">
<td>geom</td>
<td>Point</td>
<td>(optional)</td>
</tr>
<tr class="even">
<td>name</td>
<td>String</td>
<td>(optional, does not have to be unique)</td>
</tr>
<tr class="odd">
<td>subnetwork_id</td>
<td>Int32</td>
<td>(optional)</td>
</tr>
<tr class="even">
<td>route_priority</td>
<td>Int32</td>
<td>(optional, does not have to be unique)</td>
</tr>
<tr class="odd">
<td>cyclic_time</td>
<td>Bool</td>
<td>(optional, defaults to false)</td>
</tr>
</tbody>
</table>
<p>If not set, the <code>route_priority</code> is fixed per node type as explained in the <a href="#sec-allocation-settings">allocation settings</a>.</p>
<p>Adding a point geometry to the node table can be helpful to examine models in <a href="https://qgis.org/en/site/">QGIS</a>, as it will show the location of the nodes on the map. The geometry is not used by Ribasim.</p>
<section id="cyclic-time-series" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="cyclic-time-series"><span class="header-section-number">3.1</span> Cyclic time series</h2>
<p>When <code>cyclic_time</code> is set to true for a node in the Node table, every time series associated with that node in the corresponding table(s) will be interpreted as cyclic. That is: the time series is exactly repeated left and right of the original time interval to cover the whole simulation period. For this it is validated that the first and last data values in the timeseries are the same. For instance, quarterly precipitation requires giving values for every quarter at the start of the quarter, and then the value for the first quarter again at the start of the next year.</p>
<p>Note that periods like months or years are not of constant length in the calendar, so over long simulation periods the timeseries can get out of sync with these periods on the calendar.</p>
</section>
<section id="subnetwork-id" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="subnetwork-id"><span class="header-section-number">3.2</span> Subnetwork ID</h2>
<p>Nodes can only be controlled by allocation if the have a subnetwork_id. In the Node table, give for example subnetwork_id an integer value of 1 or 2.</p>
<p>When Pumps and Outlets are part of a subnetwork, they can be controlled by allocation. To accomplish this, besides a subnetwork_id, they must be given the special control state <code>Ribasim.allocation</code> in the static table for <a href="../reference/node/pump.html#static">Pump</a> or <a href="../reference/node/outlet.html#static">Outlet</a>.</p>
</section>
</section>
<section id="sec-link" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Link</h1>
<p>Links define connections between nodes. The only thing that defines an link is the nodes it connects, and in what direction. There are currently 2 possible link types:</p>
<ol type="1">
<li>“flow”: Flows between nodes are stored on links. The effect of the link direction depends on the node type, Node types that have a notion of an upstream and downstream side use the incoming link as the upstream side, and the outgoing link as the downstream side. This means that links should generally be drawn in the main flow direction. But for instance between two <code>LinearResistances</code> the link direction does not affect anything, other than the sign of the flow on the link. The sign of the flow follows the link direction; a positive flow flows along the link direction, a negative flow in the opposite way.</li>
<li>“control”: The control links define which nodes are influenced by a particular control or demand node. No water flows over these links, only information. Control links should always point away from the control or demand node. The links between the control node and the nodes it <em>listens</em> to are <em>not</em> present in <code>Link</code>, these are defined as <code>listen_node_id</code> in the control node tables. The LevelDemand and FlowDemand nodes use control links to indicate which nodes it will assign demands to.</li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 53%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>from_node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="even">
<td>to_node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>link_type</td>
<td>String</td>
<td>must be “flow” or “control”</td>
</tr>
<tr class="even">
<td>geom</td>
<td>LineString or MultiLineString</td>
<td>(optional)</td>
</tr>
<tr class="odd">
<td>name</td>
<td>String</td>
<td>(optional, does not have to be unique)</td>
</tr>
</tbody>
</table>
<p>Similarly to the node table, you can use a geometry to visualize the connections between the nodes in QGIS. For instance, you can draw a line connecting the two node coordinates.</p>
</section>
<section id="sec-results" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Results</h1>
<section id="basin---basin" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="basin---basin"><span class="header-section-number">5.1</span> Basin - <code>basin</code></h2>
<p>The Basin table contains:</p>
<ul>
<li>Results of the storage and level of each Basin, which are instantaneous values;</li>
<li>Results of the fluxes on each Basin, which are mean values over the <code>saveat</code> intervals. In the time column the start of the period is indicated.</li>
<li>The initial condition is written to the file, but the final state is not. It will be placed in a separate output state file in the future.</li>
<li>The <code>inflow_rate</code> and <code>outflow_rate</code> are the sum of the flows from other nodes into and out of the Basin respectively. The actual flows determine in which term they are counted, not the link direction.</li>
<li>The <code>storage_rate</code> is the net mean flow that is needed to achieve the storage change between timesteps.</li>
<li>The <code>inflow_rate</code> consists of the sum of all modelled flows into the basin: <code>inflow_rate</code> (horizontal flows into the basin, independent of link direction) + <code>precipitation</code> + <code>drainage</code>.</li>
<li>The <code>outflow_rate</code> consists of the sum of all modelled flows out of the basin: <code>outflow_rate</code> (horizontal flows out of the basin, independent of link direction) + <code>evaporation</code> + <code>infiltration</code>.</li>
<li>The <code>balance_error</code> is the difference between the <code>storage_rate</code> on one side and the <code>inflow_rate</code> and <code>outflow_rate</code> on the other side: <code>storage_rate</code> - (<code>inflow_rate</code> - <code>outflow_rate</code>). It can be used to check if the numerical error when solving the water balance is sufficiently small.</li>
<li>The <code>relative_error</code> is the fraction of the <code>balance_error</code> over the mean of the <code>total_inflow</code> and <code>total_outflow</code>.</li>
<li>The <code>convergence</code> is the scaled residual of the solver, giving an indication of which nodes converge the worst (are hardest to solve).</li>
</ul>
<p>For a more in-depth explanation of the water balance error see <a href="../concept/equations.html#the-water-balance-error">here</a>.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}\)</span></td>
</tr>
<tr class="even">
<td>storage</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3\)</span></td>
</tr>
<tr class="odd">
<td>inflow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="even">
<td>outflow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="odd">
<td>storage_rate</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="even">
<td>precipitation</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="odd">
<td>surface_runoff</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="even">
<td>evaporation</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="odd">
<td>drainage</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="even">
<td>infiltration</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="odd">
<td>balance_error</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="even">
<td>relative_error</td>
<td>Float64</td>
<td>-</td>
</tr>
<tr class="odd">
<td>convergence</td>
<td>Float64/Missing</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>The table is sorted by time, and per time it is sorted by <code>node_id</code>.</p>
</section>
<section id="flow---flow" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="flow---flow"><span class="header-section-number">5.2</span> Flow - <code>flow</code></h2>
<p>The flow table contains calculated mean flows over the <code>saveat</code> intervals for every flow link in the model. In the time column the start of the period is indicated.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>link_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>from_node_type</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="even">
<td>from_node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>to_node_type</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="even">
<td>to_node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="even">
<td>convergence</td>
<td>Float64/Missing</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>The table is sorted by time, and per time the same <code>link_id</code> order is used, though not sorted. The <code>link_id</code> value is the same as the <code>fid</code> written to the Link table, and can be used to directly look up the Link geometry. Flows from the “from” to the “to” node have a positive sign, and if the flow is reversed it will be negative. - The <code>convergence</code> is the scaled residual of the solver, giving an indication of which nodes converge the worst (are hardest to solve).</p>
</section>
<section id="sec-state" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="sec-state"><span class="header-section-number">5.3</span> State - <code>basin_state</code></h2>
<p>The Basin state table contains the water levels in each Basin at the end of the simulation.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="even">
<td>level</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}\)</span></td>
</tr>
</tbody>
</table>
<p>To use this result as the initial condition of another simulation, see the <a href="../reference/node/basin.html#sec-state">Basin / state</a> table reference.</p>
</section>
<section id="discretecontrol---control" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="discretecontrol---control"><span class="header-section-number">5.4</span> DiscreteControl - <code>control</code></h2>
<p>The control table contains a record of each change of control state: when it happened, which control node was involved, to which control state it changed and based on which truth state.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>control_node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>truth_state</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="even">
<td>control_state</td>
<td>String</td>
<td>-</td>
</tr>
</tbody>
</table>
</section>
<section id="allocation---allocation" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="allocation---allocation"><span class="header-section-number">5.5</span> Allocation - <code>allocation</code></h2>
<p>The allocation table contains a record of allocation results: when it happened, for which node, in which allocation network, and what the demand, allocated flow and realized flow were. The realized values at the starting time of the simulation can be ignored.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>subnetwork_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>node_type</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="even">
<td>node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>demand_priority</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="even">
<td>demand</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="odd">
<td>allocated</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="even">
<td>realized</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The LevelDemand node allocations are listed as node type Basin. This is because one LevelDemand node can link to multiple Basins, and doesn’t receive flow by itself.</p>
</div>
</div>
<p>For Basins the values <code>demand</code>, <code>allocated</code> and <code>realized</code> are positive if the Basin level is below the minimum level given by a <code>LevelDemand</code> node. The values are negative if the Basin supplies due to a surplus of water.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Currently the stored demand and abstraction rate are those at the allocation timepoint (and the abstraction rate is based on the previous allocation optimization). In the future these will be an average over the previous allocation timestep.</p>
</div>
</div>
</section>
<section id="allocation-flow---allocation_flow" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="allocation-flow---allocation_flow"><span class="header-section-number">5.6</span> Allocation flow - <code>allocation_flow</code></h2>
<p>The allocation flow table contains results of the optimized allocation flow on every link in the model that is part of a subnetwork, for each time an optimization problem is solved (see also <a href="../concept/allocation.html#the-high-level-algorithm">here</a>). If in the model a primary network and subnetwork(s) are specified, there are 3 different types of optimization for the subnetwork: The column <code>optimization_type</code> provides the distinction between these optimization types.</p>
<ul>
<li><code>internal_sources</code>: first it will try using local sources internal to the subnetwork</li>
<li><code>collect_demands</code>: collecting its total demand (for allocating flow from the primary network to the subnetwork)</li>
<li><code>allocate</code>: allocating flow within the subnetwork</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>link_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>from_node_type</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="even">
<td>from_node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>to_node_type</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="even">
<td>to_node_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>subnetwork_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="even">
<td>flow_rate</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}^3/\text{s}\)</span></td>
</tr>
<tr class="odd">
<td>optimization_type</td>
<td>String</td>
<td>-</td>
</tr>
<tr class="even">
<td>upper_bound_hit</td>
<td>Bool</td>
<td>-</td>
</tr>
<tr class="odd">
<td>lower_bound_hit</td>
<td>Bool</td>
<td>-</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This file is currently not written when the results format is set to <code>"netcdf"</code>.</p>
</div>
</div>
</section>
<section id="allocation-feasibility-analysis---allocation_analysis_feasibility.log" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="allocation-feasibility-analysis---allocation_analysis_feasibility.log"><span class="header-section-number">5.7</span> Allocation feasibility analysis - <code>allocation_analysis_feasibility.log</code></h2>
<p>When an allocation optimization problem turns out to be infeasible, an infeasibility analysis is performed. Some user friendly data is logged in the main log, but the full report of the analysis is written to this separate file. For details on the infeasibility analysis see <a href="https://jump.dev/MathOptAnalyzer.jl/dev/">here</a>.</p>
</section>
<section id="allocation-scaling-analysis---allocation_analysis_scaling.log" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="allocation-scaling-analysis---allocation_analysis_scaling.log"><span class="header-section-number">5.8</span> Allocation scaling analysis - <code>allocation_analysis_scaling.log</code></h2>
<p>When an allocation optimization problem turns out to be infeasible, a scaling analysis is performed. Some user friendly data is logged in the main log, but the full report of the analysis is written to this separate file. For details on the infeasibility analysis see <a href="https://jump.dev/MathOptAnalyzer.jl/dev/">here</a>.</p>
</section>
<section id="concentration---concentration" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="concentration---concentration"><span class="header-section-number">5.9</span> Concentration - <code>concentration</code></h2>
<p>If the <a href="../reference/usage.html#experimental-features">experimental concentration feature</a> is enabled, the results are written to file. This file records the Basin concentrations for each substance over time. The schema below is identical to the <a href="../reference/node/basin.html#concentration-external">external Basin concentration input</a>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 14%">
<col style="width: 42%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
<th>restriction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>node_id</td>
<td>Int32</td>
<td>-</td>
<td>Basin nodes only</td>
</tr>
<tr class="even">
<td>time</td>
<td>DateTime</td>
<td>-</td>
<td></td>
</tr>
<tr class="odd">
<td>substance</td>
<td>String</td>
<td>-</td>
<td>can correspond to known Delwaq substances</td>
</tr>
<tr class="even">
<td>concentration</td>
<td>Float64</td>
<td><span class="math inline">\(\text{g}/\text{m}^3\)</span></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="subgrid-level---subgrid_level" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="subgrid-level---subgrid_level"><span class="header-section-number">5.10</span> Subgrid level - <code>subgrid_level</code></h2>
<p>This result file is only written if the model contains a <a href="../reference/node/basin.html#subgrid">Basin / subgrid</a> table. See there for more information on the meaning of this output.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>subgrid_id</td>
<td>Int32</td>
<td>-</td>
</tr>
<tr class="odd">
<td>subgrid_level</td>
<td>Float64</td>
<td><span class="math inline">\(\text{m}\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="solver-statistics---solver_stats" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="solver-statistics---solver_stats"><span class="header-section-number">5.11</span> Solver statistics - <code>solver_stats</code></h2>
<p>This result file contains statistics about the solver, which can give an insight into how well the solver is performing over time. The data is solved by <code>saveat</code> (see <a href="#configuration-file">configuration file</a>). <code>water_balance</code> refers to the right-hand-side function of the system of differential equations solved by the Ribasim core.</p>
<p>The <code>computation_time</code> is the wall time in milliseconds spent on the given period. The first row tends to include compilation time as well. The <code>dt</code> is the size (in seconds) of the last calculation timestep (at the <code>saveat</code> timestep).</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>column</th>
<th>type</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>DateTime</td>
<td>-</td>
</tr>
<tr class="even">
<td>computation_time</td>
<td>Float64</td>
<td><span class="math inline">\(\text{ms}\)</span></td>
</tr>
<tr class="odd">
<td>water_balance_calls</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>linear_solves</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="odd">
<td>accepted_timesteps</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="even">
<td>rejected_timesteps</td>
<td>Int</td>
<td>-</td>
</tr>
<tr class="odd">
<td>dt</td>
<td>Float64</td>
<td><span class="math inline">\(\text{s}\)</span></td>
</tr>
</tbody>
</table>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-shampine1997matlab" class="csl-entry" role="listitem">
Shampine, Lawrence F, and Mark W Reichelt. 1997. <span>“The Matlab Ode Suite.”</span> <em>SIAM Journal on Scientific Computing</em> 18 (1): 1–22.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../reference/index.html" class="pagination-link" aria-label="Reference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Reference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../reference/validation.html" class="pagination-link" aria-label="Validation">
        <span class="nav-page-text">Validation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>